<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link
			href="https://fonts.googleapis.com/css?family=Roboto&display=swap"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="qrcode.css" />
		<title>CHIP: QR Code</title>
	</head>

	<body>
		<div class="wrapper">
			<div class="container">

				<form onsubmit="onSubmitData()" id="qrgeneratorform">
					<input
						type="text"
						id="qrcodetext"
						placeholder="Enter QR Code Text"
						class="input-box"
					/>
					<button type="submit" class="qrcode-btn">
						Generate QRcode
					</button>
				</form>

				<div id="qrcode-container">
					<div class="qrconde-wrapper">
						<div>
							<h4>
								Please scan with your CHIPTool app.
							</h4>
							<div id="qrcode"></div>
						</div>

						<div id="payload-info">
							<p id="payload"></p>
							<p>
								This QR code is unique for your device. You may
								print a copy of this for subsequent use.
							</p>

							<button onclick="window.print()" class="noprint">
								Print QR Code
							</button>
						</div>
					</div>
				</div>
			</div>

			<div class="footer">
				<p>
					This QR code is generated using
					<a
						href="https://davidshimjs.github.io/qrcodejs/"
						target="_blank"
						>qrcodejs</a
					>
				</p>
			</div>
		</div>
		<script src="qrcode.min.js"></script>
		<script type="text/javascript">
			let data;
			let qrcontainer = document.querySelector('#qrcode-container');
			let qrcodeform = document.querySelector('#qrgeneratorform');

			let link = new URLSearchParams(window.location.search);
			let linkdata = link.get('data');

			if (linkdata) {
				qrcodeform.style.display = 'none';
			}

			function generateQRcode(data) {
				document.querySelector(
					'#payload'
				).innerHTML = `Payload: ${data}`;
				var qrcode = new QRCode(document.getElementById('qrcode'), {
					text: data,
					width: 250,
					height: 250,
					colorDark: '#000000',
					colorLight: '#ffffff',
					correctLevel: QRCode.CorrectLevel.H,
				});
			}

			function showQRcodeBlock(data) {
				if (data) {
					qrcontainer.style.display = 'block';
				}
			}

			if (linkdata) {
				showQRcodeBlock(linkdata);
				generateQRcode(linkdata);
			}

			function onSubmitData() {
				event.preventDefault();
				let data = document.querySelector('#qrcodetext').value;
				showQRcodeBlock(data);
				generateQRcode(data);
			}
		</script>
	</body>
</html>

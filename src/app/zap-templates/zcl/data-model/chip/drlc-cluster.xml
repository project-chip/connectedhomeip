<?xml version="1.0"?>
<!--
Copyright (c) 2023-2025 Project CHIP Authors

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<!--
XML generated by Alchemy; DO NOT EDIT.
Source: src/app_clusters/DemandResponseLoadControl.adoc
Parameters: in-progress 
Git: 
-->
<configurator xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../zcl.xsd">
  <domain name="Energy Management"/>
  <bitmap name="EventControlBitmap" type="bitmap16">
    <cluster code="0x0096"/>
    <field name="RandomStart" mask="0x01"/>
  </bitmap>

  <bitmap name="EventTransitionControlBitmap" type="bitmap16">
    <cluster code="0x0096"/>
    <field name="RandomDuration" mask="0x01"/>
    <field name="IgnoreOptOut" mask="0x02"/>
  </bitmap>

  <bitmap name="CancelControlBitmap" type="bitmap16">
    <cluster code="0x0096"/>
    <field name="RandomEnd" mask="0x01"/>
  </bitmap>

  <enum name="LoadControlEventStatusEnum" type="enum8">
    <cluster code="0x0096"/>
    <item name="Unknown" value="0x00"/>
    <item name="Received" value="0x01"/>
    <item name="InProgress" value="0x02"/>
    <item name="Completed" value="0x03"/>
    <item name="OptedOut" value="0x04"/>
    <item name="OptedIn" value="0x05"/>
    <item name="Canceled" value="0x06"/>
    <item name="Superseded" value="0x07"/>
    <item name="PartialOptedOut" value="0x08"/>
    <item name="PartialOptedIn" value="0x09"/>
    <item name="NoParticipation" value="0x0A"/>
    <item name="Unavailable" value="0x0B"/>
    <item name="Failed" value="0x0C"/>
  </enum>

  <enum name="CriticalityLevelEnum" type="enum8">
    <cluster code="0x0096"/>
    <item name="Unknown" value="0x00"/>
    <item name="Green" value="0x01"/>
    <item name="Level1" value="0x02"/>
    <item name="Level2" value="0x03"/>
    <item name="Level3" value="0x04"/>
    <item name="Level4" value="0x05"/>
    <item name="Level5" value="0x06"/>
  </enum>

  <enum name="HeatingSourceEnum" type="enum8">
    <cluster code="0x0096"/>
    <item name="Any" value="0x0"/>
    <item name="Electric" value="0x1"/>
    <item name="NonElectric" value="0x2"/>
  </enum>

  <struct name="TemperatureControlStruct">
    <cluster code="0x0096"/>
    <!-- Note: No TemperatureDifference type available yet in ZAP XML -->
    <item fieldId="0" name="CoolingTempOffset" type="int16s" isNullable="true" optional="true"/>
    <item fieldId="1" name="HeatingTempOffset" type="int16s" isNullable="true" optional="true"/>
    <item fieldId="2" name="CoolingTempSetpoint" type="temperature" isNullable="true" optional="true"/>
    <item fieldId="3" name="HeatingTempSetpoint" type="temperature" isNullable="true" optional="true"/>
  </struct>

  <struct name="AverageLoadControlStruct">
    <cluster code="0x0096"/>
    <item fieldId="0" name="LoadAdjustment" type="int8s" min="-100" max="100"/>
  </struct>

  <struct name="DutyCycleControlStruct">
    <cluster code="0x0096"/>
    <item fieldId="0" name="DutyCycle" type="percent"/>
  </struct>

  <struct name="PowerSavingsControlStruct">
    <cluster code="0x0096"/>
    <item fieldId="0" name="PowerSavings" type="percent"/>
  </struct>

  <struct name="HeatingSourceControlStruct">
    <cluster code="0x0096"/>
    <item fieldId="0" name="HeatingSource" type="HeatingSourceEnum" min="0x00" max="0x02"/>
  </struct>

  <struct name="LoadControlEventTransitionStruct">
    <cluster code="0x0096"/>
    <item fieldId="0" name="Duration" type="int16u" max="1440" default="0"/>
    <item fieldId="1" name="Control" type="EventTransitionControlBitmap" default="0x0000" min="0x0000" max="0x0003"/>
    <item fieldId="2" name="TemperatureControl" type="TemperatureControlStruct" optional="true"/>
    <item fieldId="3" name="AverageLoadControl" type="AverageLoadControlStruct" optional="true"/>
    <item fieldId="4" name="DutyCycleControl" type="DutyCycleControlStruct" optional="true"/>
    <item fieldId="5" name="PowerSavingsControl" type="PowerSavingsControlStruct" optional="true"/>
    <item fieldId="6" name="HeatingSourceControl" type="HeatingSourceControlStruct" optional="true"/>
  </struct>

  <!-- This does not quite match the spec, which has LoadControlEventStruct as a
       fabric-scoped struct with some fabric-sensitive fields, but that doesn't
       really make sense in all the places where the struct is used, and the spec
       does not really define other things in a way that would work with that at
       the moment. -->
  <struct name="LoadControlEventStruct">
    <cluster code="0x0096"/>
    <item fieldId="0" name="EventID" type="octet_string" length="16" default="0" minLength="16"/>
    <item fieldId="1" name="ProgramID" type="octet_string" length="16" isNullable="true" minLength="16"/>
    <item fieldId="2" name="Status" type="LoadControlEventStatusEnum" optional="true" min="0x00" max="0x0C"/>
    <item fieldId="3" name="Control" type="EventControlBitmap" default="0x0001" min="0x0000" max="0x0001"/>
    <item fieldId="4" name="Criticality" type="CriticalityLevelEnum" default="0x00" min="0x00" max="0x06"/>
    <item fieldId="5" name="StartTime" type="epoch_s" defaut="0" isNullable="true"/>
    <item fieldId="6" name="Transitions" type="LoadControlEventTransitionStruct" array="true" length="255"/>
  </struct>

  <struct name="LoadControlProgramStruct">
    <cluster code="0x0096"/>
    <item fieldId="0" name="ProgramID" type="octet_string" length="16" default="0" minLength="16"/>
    <item fieldId="1" name="Name" type="char_string" length="32"/>
    <item fieldId="2" name="RandomStartMinutes" type="int8u" isNullable="true" max="60"/>
    <item fieldId="3" name="RandomDurationMinutes" type="int8u" isNullable="true" max="0x3C"/>
  </struct>

  <cluster apiMaturity="provisional">
    <name>Demand Response Load Control</name>
    <domain>Energy Management</domain>
    <description>This cluster provides an interface to the functionality of Smart Energy Demand Response and Load Control.</description>
    <code>0x0096</code>
    <define>DEMAND_RESPONSE_LOAD_CONTROL_CLUSTER</define>
    <client tick="false" init="false">true</client>
    <server tick="false" init="false">true</server>
    <globalAttribute side="either" code="0xFFFD" value="4"/>
    <features>
      <feature bit="0" code="TEMPO" name="TemperatureOffset" summary="Supports temperature offsets">
        <optionalConform choice="a" more="true" min="1"/>
      </feature>
      <feature bit="1" code="TEMPS" name="TemperatureSetpoint" summary="Supports temperature setpoints">
        <optionalConform choice="a" more="true" min="1"/>
      </feature>
      <feature bit="2" code="LOADA" name="LoadAdjustment" summary="Supports average load adjustment percentage">
        <optionalConform choice="a" more="true" min="1"/>
      </feature>
      <feature bit="3" code="DUTYC" name="DutyCycle" summary="Supports duty cycle adjustment">
        <optionalConform choice="a" more="true" min="1"/>
      </feature>
      <feature bit="4" code="PWRSV" name="PowerSavings" summary="Supports power savings">
        <optionalConform choice="a" more="true" min="1"/>
      </feature>
      <feature bit="5" code="HEATS" name="HeatingSource" summary="Supports selecting heating source">
        <optionalConform choice="a" more="true" min="1"/>
      </feature>
    </features>
    <attribute side="server" code="0x0000" name="LoadControlPrograms" define="LOAD_CONTROL_PROGRAMS" type="array" entryType="LoadControlProgramStruct" length="255"/>
    <attribute side="server" code="0x0001" name="NumberOfLoadControlPrograms" define="NUMBER_OF_LOAD_CONTROL_PROGRAMS" type="int8u" min="5" default="5"/>
    <attribute side="server" code="0x0002" name="Events" define="LOAD_CONTROL_EVENTS" type="array" entryType="LoadControlEventStruct" length="65280"/>
    <attribute side="server" code="0x0003" name="ActiveEvents" define="LOAD_CONTROL_ACTIVE_EVENTS" type="array" entryType="octet_string" length="65280"/>
    <attribute side="server" code="0x0004" name="NumberOfEventsPerProgram" define="NUMBER_OF_EVENTS_PER_PROGRAM" type="int8u" min="10" default="10"/>
    <attribute side="server" code="0x0005" name="NumberOfTransitions" define="NUMBER_OF_TRANSITIONS" type="int8u" min="3" default="3"/>
    <attribute side="server" code="0x0006" name="DefaultRandomStart" define="DEFAULT_RANDOM_START" type="int8u" max="0x3C" default="0x1E" writable="true">
      <access op="write" privilege="manage"/>
    </attribute>
    <attribute side="server" code="0x0007" name="DefaultRandomDuration" define="DEFAULT_RANDOM_DURATION" type="int8u" max="0x3C" default="0" writable="true">
      <access op="write" privilege="manage"/>
    </attribute>
    <command source="client" code="0x00" name="RegisterLoadControlProgramRequest" optional="false">
      <description>Upon receipt, this SHALL insert a new LoadControlProgramStruct into LoadControlPrograms, or if the ProgramID matches an existing LoadControlProgramStruct, then the existing LoadControlProgramStruct SHALL be overwritten with the provided values.</description>
      <arg id="0" name="LoadControlProgram" type="LoadControlProgramStruct"/>
    </command>

    <command source="client" code="0x01" name="UnregisterLoadControlProgramRequest" optional="false">
      <description>Upon receipt, this SHALL remove the LoadControlProgramStruct with the matching ProgramID, if it exists, from LoadControlPrograms.</description>
      <arg id="0" name="LoadControlProgramID" type="octet_string" length="16" minLength="16"/>
    </command>

    <command source="client" code="0x02" name="AddLoadControlEventRequest" optional="false">
      <description>On receipt of this command, the server SHALL perform the following procedure: </description>
      <arg id="0" name="Event" type="LoadControlEventStruct"/>
    </command>

    <command source="client" code="0x03" name="RemoveLoadControlEventRequest" optional="false">
      <description>On receipt of this command, the server SHALL remove any load control events in Events whose EventID matches EventID, either immediately if the RandomEnd Bit bit is not set on the CancelControl field, or after a random duration.</description>
      <arg id="0" name="EventID" type="octet_string" length="16" minLength="16"/>
      <arg id="1" name="CancelControl" type="CancelControlBitmap" default="0x0000" min="0x0000" max="0x0001"/>
    </command>

    <event side="server" code="0x00" name="LoadControlEventStatusChange" priority="info">
      <description>This event SHALL be generated when the status of a LoadControlEventStruct changes.</description>
      <field id="0" name="EventID" type="octet_string" length="16" minLength="16"/>
      <field id="1" name="TransitionIndex" type="int8u"/>
      <field id="2" name="Status" type="LoadControlEventStatusEnum" min="0x00" max="0x0C"/>
      <field id="3" name="Criticality" type="CriticalityLevelEnum" min="0x00" max="0x06"/>
      <field id="4" name="Control" type="EventControlBitmap" default="0x0000" min="0x0000" max="0x0001"/>
      <field id="5" name="TemperatureControl" type="TemperatureControlStruct" isNullable="true" optional="true"/>
      <field id="6" name="AverageLoadControl" type="AverageLoadControlStruct" isNullable="true" optional="true"/>
      <field id="7" name="DutyCycleControl" type="DutyCycleControlStruct" isNullable="true" optional="true"/>
      <field id="8" name="PowerSavingsControl" type="PowerSavingsControlStruct" isNullable="true" optional="true"/>
      <field id="9" name="HeatingSourceControl" type="HeatingSourceControlStruct" isNullable="true" optional="true"/>
      <!-- Spec has an invalid field ID that cannot be used, so not enabling the Signature field for now.  See
           https://github.com/CHIP-Specifications/connectedhomeip-spec/issues/8515 -->
      <!-- <field id="0xFF" name="Signature" type="octet_string" length="48" isNullable="true"/> -->
    </event>

  </cluster>
</configurator>

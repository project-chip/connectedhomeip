# Copyright (c) 2021 Project CHIP Authors
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# Auto-generated scripts for harness use only, please review before automation. The endpoints and cluster names are currently set to default

name:
    3.4.2. [TC-IDM-4.2] Subscription Response Messages from DUT Test Cases.
    [{DUT_Server}]

PICS:
    - MCORE.IDM.S

config:
    nodeId: 0x12344321
    cluster: "Basic Information"
    endpoint: 0

tests:
    - label: "Note"
      verification: |
          Please use Interactive mode to Verify subscription test cases
          Here the command to enter interactive mode:--   ./chip-tool interactive start
      disabled: true

    - label:
          If the device is has the ICD Management cluster, TH reads from the DUT
          the IdleModeInterval attribute and sets the
          SubscriptionMaxIntervalPublisherLimit to the value read. If the device
          does not have the ICD Management cluster, set the
          SubscriptionMaxIntervalPublisherLimit to 60 minutes.
      verification: |
          The cluster used in the below command is an example,
          icdmanagement read idle-mode-interval 12344321 0
      disabled: true

    - label:
          "Step 1: TH sends a subscription message to the DUT with
          MaxIntervalCeiling set to a value greater than the
          SubscriptionMaxIntervalPublisherLimit. DUT sends a report data action
          to the TH. TH sends a success status response to the DUT. DUT sends a
          Subscribe Response Message to the TH to activate the subscription."
      verification: |
          onoff subscribe on-off  100  3900 1 1 --keepSubscriptions true

           On the TH(reference app), verify a report data message is received and verify it contains the following data :
           Report data - data of the attribute/event requested earlier.
           Verify on the TH the Subscribe Response has the following fields,
           SubscriptionId - Verify it is of type uint32.
           MaxInterval - Verify it is of type uint32.
           Verify that the MaxInterval is less than or equal MaxIntervalCeiling.

          [1686294743.438593][101362:101364] CHIP:DMG:         ],
          [1686294743.438598][101362:101364] CHIP:DMG:
          [1686294743.438601][101362:101364] CHIP:DMG:         InteractionModelRevision = 1
          [1686294743.438604][101362:101364] CHIP:DMG: }
          [1686294743.438641][101362:101364] CHIP:TOO: Endpoint: 1 Cluster: 0x0000_0006 Attribute 0x0000_0000 DataVersion: 3334871844
          [1686294743.438651][101362:101364] CHIP:TOO:   OnOff: FALSE
          [1686294743.438663][101362:101364] CHIP:DMG: MoveToState ReadClient[0x7fc7ec011c50]: Moving to [AwaitingSu]
          [1686294743.438688][101362:101364] CHIP:EM: <<< [E:49832i S:18140 M:226017852 (Ack:29621147)] (S) Msg TX to 1:0000000000000001 [A822] --- Type 0001:01 (IM:StatusResponse)
          [1686294743.438695][101362:101364] CHIP:IN: (S) Sending msg 226017852 on secure session with LSID: 18140
          [1686294743.441447][101362:101364] CHIP:EM: >>> [E:49832i S:18140 M:29621148 (Ack:226017852)] (S) Msg RX from 1:0000000000000001 [A822] --- Type 0001:04 (IM:SubscribeResponse)
          [1686294743.441455][101362:101364] CHIP:EM: Found matching exchange: 49832i, Delegate: 0x7fc7ec011c60
          [1686294743.441461][101362:101364] CHIP:EM: Rxd Ack; Removing MessageCounter:226017852 from Retrans Table on exchange 49832i
          [1686294743.441467][101362:101364] CHIP:DMG: SubscribeResponse is received
          [1686294743.441475][101362:101364] CHIP:DMG: SubscribeResponseMessage =
          [1686294743.441479][101362:101364] CHIP:DMG: {
          [1686294743.441483][101362:101364] CHIP:DMG:         SubscriptionId = 0x51734852,
          [1686294743.441487][101362:101364] CHIP:DMG:         MaxInterval = 0xf3c,
          [1686294743.441490][101362:101364] CHIP:DMG:         InteractionModelRevision = 1
          [1686294743.441494][101362:101364] CHIP:DMG: }
          [1686294743.441498][101362:101364] CHIP:DMG: Subscription established with SubscriptionID = 0x51734852 MinInterval = 100s MaxInterval = 3900s Peer = 01:0000000000000001
          [1686294743.441504][101362:101364] CHIP:DMG: MoveToState ReadClient[0x7fc7ec011c50]: Moving to [Subscripti]
      disabled: true

    - label:
          "Step 2: TH sends a subscription message to the DUT with
          MaxIntervalCeiling set to a value less than han the
          SubscriptionMaxIntervalPublisherLimit. DUT sends a report data action
          to the TH. TH sends a success status response to the DUT. DUT sends a
          Subscribe Response Message to the TH to activate the subscription."
      verification: |
          basicinformation subscribe location 10 2400 1 0 --keepSubscriptions true
          On the TH(chip-tool), verify a report data message is received and verify it contains the following data :
           Report data - data of the attribute/event requested earlier.
           Verify on the TH the Subscribe Response has the following fields,
           SubscriptionId - Verify it is of type uint32.
           MaxInterval - Verify it is of type uint32.
           Verify that the MaxInterval is less than or equal to the MaxIntervalCeiling.

          [1686294932.404445][101362:101364] CHIP:DMG:         InteractionModelRevision = 1
          [1686294932.404449][101362:101364] CHIP:DMG: }
          [1686294932.404497][101362:101364] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_0028 Attribute 0x0000_0006 DataVersion: 946377024
          [1686294932.404508][101362:101364] CHIP:TOO:   Location: XX
          [1686294932.404523][101362:101364] CHIP:DMG: MoveToState ReadClient[0x7fc7ec00e400]: Moving to [AwaitingSu]
          [1686294932.404565][101362:101364] CHIP:EM: <<< [E:49833i S:18140 M:226017855 (Ack:29621149)] (S) Msg TX to 1:0000000000000001 [A822] --- Type 0001:01 (IM:StatusResponse)
          [1686294932.404575][101362:101364] CHIP:IN: (S) Sending msg 226017855 on secure session with LSID: 18140
          [1686294932.420682][101362:101364] CHIP:EM: >>> [E:49833i S:18140 M:29621150 (Ack:226017855)] (S) Msg RX from 1:0000000000000001 [A822] --- Type 0001:04 (IM:SubscribeResponse)
          [1686294932.420716][101362:101364] CHIP:EM: Found matching exchange: 49833i, Delegate: 0x7fc7ec00e410
          [1686294932.420737][101362:101364] CHIP:EM: Rxd Ack; Removing MessageCounter:226017855 from Retrans Table on exchange 49833i
          [1686294932.420754][101362:101364] CHIP:DMG: SubscribeResponse is received
          [1686294932.420777][101362:101364] CHIP:DMG: SubscribeResponseMessage =
          [1686294932.420787][101362:101364] CHIP:DMG: {
          [1686294932.420796][101362:101364] CHIP:DMG:         SubscriptionId = 0xcbbba269,
          [1686294932.420805][101362:101364] CHIP:DMG:         MaxInterval = 0x960,
          [1686294932.420815][101362:101364] CHIP:DMG:         InteractionModelRevision = 1
          [1686294932.420822][101362:101364] CHIP:DMG: }
          [1686294932.420834][101362:101364] CHIP:DMG: Subscription established with SubscriptionID = 0xcbbba269 MinInterval = 10s MaxInterval = 2400s Peer = 01:0000000000000001
          [1686294932.420847][101362:101364] CHIP:DMG: MoveToState ReadClient[0x7fc7ec00e400]: Moving to [Subscripti]
      disabled: true

    - label:
          "Step 3: Setup TH2 such that it does not have access to an attribute
          on a specific cluster and endpoint. TH2 sends a subscription message
          to subscribe to an attribute for which it does not have access.
          AttributePath = [[Attribute = Attribute, Cluster = ClusterID, Endpoint
          = EndpointID ]]."
      verification: |
          As per Spec, there is no access control to specifically enable/disable access to an attribute, so the wording of the test plan need to be modified

          https://github.com/CHIP-Specifications/chip-test-plans/issues/2366
      disabled: true

    - label:
          "Step 4: Setup TH2 such that it does not have access to all attributes
          on a specific cluster and endpoint. TH2 sends a subscription request
          to subscribe to all attributes for which it does not have access.
          AttributePath = [[Cluster = ClusterID, Endpoint = EndpointID ]]."
      verification: |
          To Setup the TH2(chip-tool) such that it should not have the privilege for the cluster in the path(AttributePath = [[Attribute = Attribute, Cluster = ClusterID, Endpoint = EndpointID ]]).  1st we need to send below mentioned ACL command and Here by sending below mentioned ACL command giving only access for Level control cluster(8), So except Level control cluster if try to subscribe any other cluster commands will get status as INVALID_ACTION .

          accesscontrol write acl '[{"privilege":5, "authMode":2, "subjects":[112233], "targets":null, "fabricIndex": 1},{"privilege":3, "authMode":2, "subjects":[4], "targets":[{"cluster":8, "endpoint":1, "deviceType":null}]}]' 1 0

          [1687418564.590285][167960:167962] CHIP:DMG: WriteResponseMessage =
          [1687418564.590290][167960:167962] CHIP:DMG: {
          [1687418564.590294][167960:167962] CHIP:DMG:         AttributeStatusIBs =
          [1687418564.590304][167960:167962] CHIP:DMG:         [
          [1687418564.590313][167960:167962] CHIP:DMG:                 AttributeStatusIB =
          [1687418564.590321][167960:167962] CHIP:DMG:                 {
          [1687418564.590327][167960:167962] CHIP:DMG:                         AttributePathIB =
          [1687418564.590336][167960:167962] CHIP:DMG:                         {
          [1687418564.590346][167960:167962] CHIP:DMG:                                 Endpoint = 0x0,
          [1687418564.590355][167960:167962] CHIP:DMG:                                 Cluster = 0x1f,
          [1687418564.590366][167960:167962] CHIP:DMG:                                 Attribute = 0x0000_0000,
          [1687418564.590374][167960:167962] CHIP:DMG:                         }
          [1687418564.590385][167960:167962] CHIP:DMG:
          [1687418564.590392][167960:167962] CHIP:DMG:                         StatusIB =
          [1687418564.590406][167960:167962] CHIP:DMG:                         {
          [1687418564.590415][167960:167962] CHIP:DMG:                                 status = 0x00 (SUCCESS),
          [1687418564.590423][167960:167962] CHIP:DMG:                         },
          [1687418564.590433][167960:167962] CHIP:DMG:
          [1687418564.590444][167960:167962] CHIP:DMG:                 },
          [1687418564.590462][167960:167962] CHIP:DMG:
          [1687418564.590469][167960:167962] CHIP:DMG:                 AttributeStatusIB =
          [1687418564.590477][167960:167962] CHIP:DMG:                 {
          [1687418564.590484][167960:167962] CHIP:DMG:                         AttributePathIB =
          [1687418564.590493][167960:167962] CHIP:DMG:                         {
          [1687418564.590502][167960:167962] CHIP:DMG:                                 Endpoint = 0x0,
          [1687418564.590512][167960:167962] CHIP:DMG:                                 Cluster = 0x1f,
          [1687418564.590521][167960:167962] CHIP:DMG:                                 Attribute = 0x0000_0000,
          [1687418564.590530][167960:167962] CHIP:DMG:                                 ListIndex = Null,
          [1687418564.590539][167960:167962] CHIP:DMG:                         }
          [1687418564.590552][167960:167962] CHIP:DMG:
          [1687418564.590559][167960:167962] CHIP:DMG:                         StatusIB =
          [1687418564.590567][167960:167962] CHIP:DMG:                         {
          [1687418564.590576][167960:167962] CHIP:DMG:                                 status = 0x00 (SUCCESS),
          [1687418564.590584][167960:167962] CHIP:DMG:                         },
          [1687418564.590593][167960:167962] CHIP:DMG:
          [1687418564.590601][167960:167962] CHIP:DMG:                 },
          [1687418564.590616][167960:167962] CHIP:DMG:
          [1687418564.590623][167960:167962] CHIP:DMG:                 AttributeStatusIB =
          [1687418564.590631][167960:167962] CHIP:DMG:                 {
          [1687418564.590638][167960:167962] CHIP:DMG:                         AttributePathIB =
          [1687418564.590647][167960:167962] CHIP:DMG:                         {
          [1687418564.590656][167960:167962] CHIP:DMG:                                 Endpoint = 0x0,
          [1687418564.590665][167960:167962] CHIP:DMG:                                 Cluster = 0x1f,
          [1687418564.590675][167960:167962] CHIP:DMG:                                 Attribute = 0x0000_0000,
          [1687418564.590683][167960:167962] CHIP:DMG:                                 ListIndex = Null,
          [1687418564.590691][167960:167962] CHIP:DMG:                         }
          [1687418564.590704][167960:167962] CHIP:DMG:
          [1687418564.590712][167960:167962] CHIP:DMG:                         StatusIB =
          [1687418564.590720][167960:167962] CHIP:DMG:                         {
          [1687418564.590729][167960:167962] CHIP:DMG:                                 status = 0x00 (SUCCESS),
          [1687418564.590738][167960:167962] CHIP:DMG:                         },
          [1687418564.590747][167960:167962] CHIP:DMG:
          [1687418564.590754][167960:167962] CHIP:DMG:                 },
          [1687418564.590768][167960:167962] CHIP:DMG:
          [1687418564.590776][167960:167962] CHIP:DMG:         ],
          [1687418564.590796][167960:167962] CHIP:DMG:
          [1687418564.590804][167960:167962] CHIP:DMG:         InteractionModelRevision = 1
          [1687418564.590811][167960:167962] CHIP:DMG: }
          [1687418564.590882][167960:167962] CHIP:DMG: WriteClient moving to [AwaitingDe]

           Try to subscribe to all attributes onto endpoint 1 for cluster “onoff” from a node id that have access to the “levelcontrol” cluster onto endpoint 1

          onoff subscribe-by-id 0xFFFFFFFF 5 100 1 1  --commissioner-nodeid  4
          [1687418591.903193][167960:167962] CHIP:EM: Found matching exchange: 3641i, Delegate: 0x7fc81c00bbd0
          [1687418591.903197][167960:167962] CHIP:EM: Rxd Ack; Removing MessageCounter:104560060 from Retrans Table on exchange 3641i
          [1687418591.903206][167960:167962] CHIP:DMG: StatusResponseMessage =
          [1687418591.903209][167960:167962] CHIP:DMG: {
          [1687418591.903211][167960:167962] CHIP:DMG:         Status = 0x80 (INVALID_ACTION),
          [1687418591.903213][167960:167962] CHIP:DMG:         InteractionModelRevision = 1
          [1687418591.903215][167960:167962] CHIP:DMG: }
          [1687418591.903220][167960:167962] CHIP:IM: Received status response, status is 0x80 (INVALID_ACTION)
          [1687418591.903236][167960:167962] CHIP:EM: <<< [E:3641i S:26604 M:104560061 (Ack:37058090)] (S) Msg TX to 2:0000000000000001 [2DB4] --- Type 0001:01 (IM:StatusResponse)
          [1687418591.903241][167960:167962] CHIP:IN: (S) Sending msg 104560061 on secure session with LSID: 26604
          [1687418591.903262][167960:167962] CHIP:DMG: MoveToState ReadClient[0x7fc81c00bbc0]: Moving to

          With the ACL command in step-2, we are overwriting the default privilege that chip-tool has an admin. After this step-3 you need to send below mentioned command to Grant access to all clusters again.
          accesscontrol write acl '[{"fabricIndex": 1, "privilege": 5, "authMode":2, "subjects":[112233,4], "targets":null}]' 1 0
      disabled: true

    - label:
          "Step 5: Setup TH2 such that it does not have access to an Endpoint.
          TH2 sends a subscription request to subscribe to all attributes on all
          clusters on a specific Endpoint for which it does not have access.
          AttributePath = [[ Endpoint = EndpointID ]]."
      verification: |
          To Setup the TH2(chip-tool) such that it should not have the privilege for the cluster in the path(AttributePath = [[ Endpoint = EndpointID ]]).  1st we need to send below mentioned ACL command and Here by sending below mentioned ACL command giving only access for Level control cluster(8), So except Level control cluster if try to subscribe any other cluster commands will get status as INVALID_ACTION .


           accesscontrol write acl '[{"privilege":5, "authMode":2, "subjects":[112233], "targets":null, "fabricIndex": 1},{"privilege":3, "authMode":2, "subjects":[4], "targets":[{"cluster":null, "endpoint":1, "deviceType":null}]}]' 1 0

          [1687418943.852982][167960:167962] CHIP:DMG: WriteResponseMessage =
          [1687418943.852989][167960:167962] CHIP:DMG: {
          [1687418943.852996][167960:167962] CHIP:DMG:         AttributeStatusIBs =
          [1687418943.853006][167960:167962] CHIP:DMG:         [
          [1687418943.853012][167960:167962] CHIP:DMG:                 AttributeStatusIB =
          [1687418943.853018][167960:167962] CHIP:DMG:                 {
          [1687418943.853024][167960:167962] CHIP:DMG:                         AttributePathIB =
          [1687418943.853034][167960:167962] CHIP:DMG:                         {
          [1687418943.853042][167960:167962] CHIP:DMG:                                 Endpoint = 0x0,
          [1687418943.853053][167960:167962] CHIP:DMG:                                 Cluster = 0x1f,
          [1687418943.853060][167960:167962] CHIP:DMG:                                 Attribute = 0x0000_0000,
          [1687418943.853067][167960:167962] CHIP:DMG:                         }
          [1687418943.853080][167960:167962] CHIP:DMG:
          [1687418943.853087][167960:167962] CHIP:DMG:                         StatusIB =
          [1687418943.853095][167960:167962] CHIP:DMG:                         {
          [1687418943.853103][167960:167962] CHIP:DMG:                                 status = 0x00 (SUCCESS),
          [1687418943.853109][167960:167962] CHIP:DMG:                         },
          [1687418943.853117][167960:167962] CHIP:DMG:
          [1687418943.853123][167960:167962] CHIP:DMG:                 },
          [1687418943.853136][167960:167962] CHIP:DMG:
          [1687418943.853142][167960:167962] CHIP:DMG:                 AttributeStatusIB =
          [1687418943.853148][167960:167962] CHIP:DMG:                 {
          [1687418943.853154][167960:167962] CHIP:DMG:                         AttributePathIB =
          [1687418943.853161][167960:167962] CHIP:DMG:                         {
          [1687418943.853167][167960:167962] CHIP:DMG:                                 Endpoint = 0x0,
          [1687418943.853175][167960:167962] CHIP:DMG:                                 Cluster = 0x1f,
          [1687418943.853182][167960:167962] CHIP:DMG:                                 Attribute = 0x0000_0000,
          [1687418943.853189][167960:167962] CHIP:DMG:                                 ListIndex = Null,
          [1687418943.853196][167960:167962] CHIP:DMG:                         }
          [1687418943.853205][167960:167962] CHIP:DMG:
          [1687418943.853211][167960:167962] CHIP:DMG:                         StatusIB =
          [1687418943.853218][167960:167962] CHIP:DMG:                         {
          [1687418943.853227][167960:167962] CHIP:DMG:                                 status = 0x00 (SUCCESS),
          [1687418943.853233][167960:167962] CHIP:DMG:                         },
          [1687418943.853240][167960:167962] CHIP:DMG:
          [1687418943.853246][167960:167962] CHIP:DMG:                 },
          [1687418943.853258][167960:167962] CHIP:DMG:
          [1687418943.853264][167960:167962] CHIP:DMG:                 AttributeStatusIB =
          [1687418943.853274][167960:167962] CHIP:DMG:                 {
          [1687418943.853280][167960:167962] CHIP:DMG:                         AttributePathIB =
          [1687418943.853290][167960:167962] CHIP:DMG:                         {
          [1687418943.853296][167960:167962] CHIP:DMG:                                 Endpoint = 0x0,
          [1687418943.853304][167960:167962] CHIP:DMG:                                 Cluster = 0x1f,
          [1687418943.853311][167960:167962] CHIP:DMG:                                 Attribute = 0x0000_0000,
          [1687418943.853318][167960:167962] CHIP:DMG:                                 ListIndex = Null,
          [1687418943.853323][167960:167962] CHIP:DMG:                         }
          [1687418943.853332][167960:167962] CHIP:DMG:
          [1687418943.853338][167960:167962] CHIP:DMG:                         StatusIB =
          [1687418943.853345][167960:167962] CHIP:DMG:                         {
          [1687418943.853352][167960:167962] CHIP:DMG:                                 status = 0x00 (SUCCESS),
          [1687418943.853359][167960:167962] CHIP:DMG:                         },
          [1687418943.853368][167960:167962] CHIP:DMG:
          [1687418943.853374][167960:167962] CHIP:DMG:                 },
          [1687418943.853383][167960:167962] CHIP:DMG:
          [1687418943.853389][167960:167962] CHIP:DMG:         ],
          [1687418943.853405][167960:167962] CHIP:DMG:
          [1687418943.853411][167960:167962] CHIP:DMG:         InteractionModelRevision = 1
          [1687418943.853418][167960:167962] CHIP:DMG: }
          [1687418943.853488][167960:167962] CHIP:DMG: WriteClient moving to [AwaitingDe]

          Try to subscribe to all attributes onto endpoint 0 for cluster 6 from a node id that have access to everything onto endpoint 1

           onoff subscribe-by-id 0xFFFFFFFF 5 100 1 0  --commissioner-nodeid  4
          [1687418974.537572][167960:167962] CHIP:EM: Rxd Ack; Removing MessageCounter:104560062 from Retrans Table on exchange 3650i
          [1687418974.537610][167960:167962] CHIP:DMG: StatusResponseMessage =
          [1687418974.537622][167960:167962] CHIP:DMG: {
          [1687418974.537631][167960:167962] CHIP:DMG:         Status = 0x80 (INVALID_ACTION),
          [1687418974.537640][167960:167962] CHIP:DMG:         InteractionModelRevision = 1
          [1687418974.537648][167960:167962] CHIP:DMG: }
          [1687418974.537658][167960:167962] CHIP:IM: Received status response, status is 0x80 (INVALID_ACTION)
          [1687418974.537725][167960:167962] CHIP:EM: <<< [E:3650i S:26604 M:104560063 (Ack:37058092)] (S) Msg TX to 2:0000000000000001 [2DB4] --- Type 0001:01 (IM:StatusResponse)
          [1687418974.537743][167960:167962] CHIP:IN: (S) Sending msg 104560063 on secure session with LSID: 26604


          With the ACL command in step-2, we are overwriting the default privilege that chip-tool has an admin. After this step-3 you need to send below mentioned command to Grant access to all clusters again.
          accesscontrol write acl '[{"fabricIndex": 1, "privilege": 5, "authMode":2, "subjects":[112233,4], "targets":null}]' 1 0
      disabled: true

    - label:
          "Step 6: Setup TH2 such that it does not have access to the Node. TH2
          sends a subscription request to subscribe to all attributes on all
          clusters on all endpoints on a Node for which it does not have access.
          AttributePath = [[ ]]."
      verification: |
          After commissioned the device, Device does not allow access for node id 4. Because it is not granted the access for Node ID 4

          Try to subscribe to all attributes onto endpoint 1 for cluster 6 from a node id that does not have any access to the node

           onoff subscribe-by-id 0xFFFFFFFF 5 100 1 0  --commissioner-nodeid  4

          [1687419427.834160][167960:167962] CHIP:EM: Rxd Ack; Removing MessageCounter:104560064 from Retrans Table on exchange 3652i
          [1687419427.834192][167960:167962] CHIP:DMG: StatusResponseMessage =
          [1687419427.834207][167960:167962] CHIP:DMG: {
          [1687419427.834216][167960:167962] CHIP:DMG:         Status = 0x80 (INVALID_ACTION),
          [1687419427.834225][167960:167962] CHIP:DMG:         InteractionModelRevision = 1
          [1687419427.834233][167960:167962] CHIP:DMG: }
          [1687419427.834242][167960:167962] CHIP:IM: Received status response, status is 0x80 (INVALID_ACTION)
          [1687419427.834293][167960:167962] CHIP:EM: <<< [E:3652i S:26604 M:104560065 (Ack:37058094)] (S) Msg TX to 2:0000000000000001 [2DB4] --- Type 0001:01 (IM:StatusResponse)
          [1687419427.834308][167960:167962] CHIP:IN: (S) Sending msg 104560065 on secure session with LSID: 26604
      disabled: true

    - label:
          "Step 7: TH sends a subscription request action for an attribute with
          an empty DataVersionFilters field. DUT sends a report data action with
          the data of the attribute along with the data version. Tear down the
          subscription for that attribute. Start another subscription with the
          DataVersionFilter field set to the data version received above."
      verification: |
          onoff  subscribe start-up-on-off  50 800 1 1 --keepSubscriptions true

           verify that subscription is activated between TH(chip-tool) and DUT(reference app) and DUT(reference-app) sends a report data action with the data of the attribute along with the data version to TH(chip-tool)
          [1686295071.084688][101362:101364] CHIP:DMG: }
          [1686295071.084713][101362:101364] CHIP:TOO: Endpoint: 1 Cluster: 0x0000_0006 Attribute 0x0000_4003 DataVersion: 3334871844
          [1686295071.084721][101362:101364] CHIP:TOO:   StartUpOnOff: null
          [1686295071.084730][101362:101364] CHIP:DMG: MoveToState ReadClient[0x7fc7ec011120]: Moving to [AwaitingSu]
          [1686295071.084754][101362:101364] CHIP:EM: <<< [E:49834i S:18140 M:226017858 (Ack:29621151)] (S) Msg TX to 1:0000000000000001 [A822] --- Type 0001:01 (IM:StatusResponse)
          [1686295071.084759][101362:101364] CHIP:IN: (S) Sending msg 226017858 on secure session with LSID: 18140
          [1686295071.087868][101362:101364] CHIP:EM: >>> [E:49834i S:18140 M:29621152 (Ack:226017858)] (S) Msg RX from 1:0000000000000001 [A822] --- Type 0001:04 (IM:SubscribeResponse)
          [1686295071.087881][101362:101364] CHIP:EM: Found matching exchange: 49834i, Delegate: 0x7fc7ec011130
          [1686295071.087887][101362:101364] CHIP:EM: Rxd Ack; Removing MessageCounter:226017858 from Retrans Table on exchange 49834i
          [1686295071.087893][101362:101364] CHIP:DMG: SubscribeResponse is received
          [1686295071.087899][101362:101364] CHIP:DMG: SubscribeResponseMessage =
          [1686295071.087902][101362:101364] CHIP:DMG: {
          [1686295071.087905][101362:101364] CHIP:DMG:         SubscriptionId = 0x6bd3d042,
          [1686295071.087908][101362:101364] CHIP:DMG:         MaxInterval = 0x320,
          [1686295071.087911][101362:101364] CHIP:DMG:         InteractionModelRevision = 1
          [1686295071.087914][101362:101364] CHIP:DMG: }
          [1686295071.087918][101362:101364] CHIP:DMG: Subscription established with SubscriptionID = 0x6bd3d042 MinInterval = 50s MaxInterval = 800s Peer = 01:0000000000000001
          [1686295071.087923][101362:101364] CHIP:DMG: MoveToState ReadClient[0x7fc7ec011120]: Moving to [Subscripti]


           Start another subscription with the DataVersionFilter field set to the data version received above and Verify that the subscription is activated between TH and DUT.
           onoff  subscribe start-up-on-off  50 800 1 1 --data-version  3334871844

          [1657450845.854472][11635:11640] CHIP:EM: Removed CHIP MessageCounter:190733050 from RetransTable on exchange 33630i
          [1657450845.854526][11635:11640] CHIP:DMG: ReportDataMessage =
          [1657450845.854555][11635:11640] CHIP:DMG: {
          [1657450845.854581][11635:11640] CHIP:DMG:      SubscriptionId = 0x6139c55e,
          [1657450845.854607][11635:11640] CHIP:DMG:      InteractionModelRevision = 1
          [1657450845.854631][11635:11640] CHIP:DMG: }
          [1657450845.854675][11635:11640] CHIP:DMG: MoveToState ReadClient[0xffff94002cb0]: Moving to [AwaitingSu]
          [1657450845.854728][11635:11640] CHIP:EM: Piggybacking Ack for MessageCounter:11055899 on exchange: 33630i
          [1657450845.854786][11635:11640] CHIP:IN: Prepared secure message 0xffff94002458 to 0x0000000000000001 (1)  of type 0x1 and protocolId (0, 1) on exchange 33630i with MessageCounter:190733051.
          [1657450845.854822][11635:11640] CHIP:IN: Sending encrypted msg 0xffff94002458 with MessageCounter:190733051 to 0x0000000000000001 (1) at monotonic time: 0000000000B04EDB msec
          [1657450845.855783][11635:11640] CHIP:EM: Received message of type 0x4 with protocolId (0, 1) and MessageCounter:11055900 on exchange 33630i
          [1657450845.855818][11635:11640] CHIP:EM: Found matching exchange: 33630i, Delegate: 0xffff94002cb0
          [1657450845.855856][11635:11640] CHIP:EM: Rxd Ack; Removing MessageCounter:190733051 from Retrans Table on exchange 33630i
          [1657450845.855876][11635:11640] CHIP:EM: Removed CHIP MessageCounter:190733051 from RetransTable on exchange 33630i
          [1657450845.855921][11635:11640] CHIP:DMG: SubscribeResponseMessage =
          [1657450845.855943][11635:11640] CHIP:DMG: {
          [1657450845.855963][11635:11640] CHIP:DMG:      SubscriptionId = 0x6bd3d042,
          [1657450845.855985][11635:11640] CHIP:DMG:      MaxInterval = 0x320,
          [1657450845.856006][11635:11640] CHIP:DMG:      InteractionModelRevision = 1
          [1657450845.856026][11635:11640] CHIP:DMG: }
          [1657450845.856050][11635:11640] CHIP:DMG: Subscription established with SubscriptionID = 0x6139c55e MinInterval = 50s MaxInterval = 800s Peer = 01:0000000000000001
      disabled: true

    - label:
          "Step 8: TH sends a subscription request action for an attribute and
          sets the MinIntervalFloor value to be same as MaxIntervalCeiling.
          Activate the Subscription between TH and DUT. Modify the attribute
          which has been subscribed to on the DUT."
      verification: |
          The cluster used in the below command is an example, User can use any supported chip cluster/attribute/command.

          onoff subscribe on-time 100 100 1 1 --keepSubscriptions true

          On TH(chip-tool) verify that the DUT sends a report data with the value of the attribute after the MinIntervalFloor time.

          [1657450934.856825][11635:11640] CHIP:EM: Removed CHIP MessageCounter:190733053 from RetransTable on exchange 33631i
          [1657450934.856955][11635:11640] CHIP:DMG: ReportDataMessage =
          [1657450934.857025][11635:11640] CHIP:DMG: {
          [1657450934.857088][11635:11640] CHIP:DMG:      SubscriptionId = 0x4b34909f,
          [1657450934.857152][11635:11640] CHIP:DMG:      AttributeReportIBs =
          [1657450934.857262][11635:11640] CHIP:DMG:      [
          [1657450934.857326][11635:11640] CHIP:DMG:              AttributeReportIB =
          [1657450934.857409][11635:11640] CHIP:DMG:              {
          [1657450934.857475][11635:11640] CHIP:DMG:                      AttributeDataIB =
          [1657450934.857553][11635:11640] CHIP:DMG:                      {
          [1657450934.857633][11635:11640] CHIP:DMG:                              DataVersion = 0x1979c37,
          [1657450934.857719][11635:11640] CHIP:DMG:                              AttributePathIB =
          [1657450934.857801][11635:11640] CHIP:DMG:                              {
          [1657450934.857885][11635:11640] CHIP:DMG:                                      Endpoint = 0x1,
          [1657450934.857974][11635:11640] CHIP:DMG:                                      Cluster = 0x6,
          [1657450934.858061][11635:11640] CHIP:DMG:                                      Attribute = 0x0000_4001,
          [1657450934.858142][11635:11640] CHIP:DMG:                              }
          [1657450934.858228][11635:11640] CHIP:DMG:
          [1657450934.858314][11635:11640] CHIP:DMG:                              Data = 0,
          [1657450934.858391][11635:11640] CHIP:DMG:                      },
          [1657450934.858471][11635:11640] CHIP:DMG:
          [1657450934.858539][11635:11640] CHIP:DMG:              },
          [1657450934.858612][11635:11640] CHIP:DMG:
          [1657450934.858672][11635:11640] CHIP:DMG:      ],
          [1657450934.858747][11635:11640] CHIP:DMG:
          [1657450934.858808][11635:11640] CHIP:DMG:      InteractionModelRevision = 1
          [1657450934.858866][11635:11640] CHIP:DMG: }
          [1657450934.859074][11635:11640] CHIP:TOO: Endpoint: 1 Cluster: 0x0000_0006 Attribute 0x0000_4001 DataVersion: 26713143
          [1657450934.859155][11635:11640] CHIP:TOO:   OnTime: 0
          [1657450934.859242][11635:11640] CHIP:DMG: MoveToState ReadClient[0xffff940027a0]: Moving to [AwaitingSu]
      disabled: true

    - label:
          "Step 9: TH sends a subscription request action for an attribute and
          set the MinIntervalFloor value to be greater than MaxIntervalCeiling.
          +"
      verification: |
          The cluster used in the below command is an example, User can use any supported chip cluster/attribute/command.

           onoff subscribe on-time 500 100 1 1 --keepSubscriptions true

          On TH(chip-tool) Verify that the DUT sends an error message and the subscription is not established.
          [1661754615.089845][103654:103659] CHIP:DMG: StatusResponseMessage =
          [1661754615.089857][103654:103659] CHIP:DMG: {
          [1661754615.089868][103654:103659] CHIP:DMG:         Status = 0x80 (INVALID_ACTION),
          [1661754615.089879][103654:103659] CHIP:DMG:         InteractionModelRevision = 1
          [1661754615.089889][103654:103659] CHIP:DMG: }
          [1661754615.089901][103654:103659] CHIP:IM: Received status response, status is 0x80 (INVALID_ACTION)
          [1661754615.089927][103654:103659] CHIP:EM: Piggybacking Ack for MessageCounter:223396916 on exchange: 6193i
      disabled: true

    - label:
          "Step 10: TH sends a subscription request to subscribe to a specific
          global attribute from all clusters on all endpoints. AttributePath =
          [[Attribute = Global Attribute]]. +"
      verification: |
          The cluster used in the below command is an example, User can use any supported chip cluster/attribute/command.

           any subscribe-by-id 0xFFFFFFFF 0xFFFD  10 300 1 0xFFFF --keepSubscriptions true


          On TH(chip-tool) Verify that the Subscription succeeds and the DUT sends back the attribute values for the global attribute
      disabled: true

    - label:
          "Step 11: TH sends a subscription request to subscribe to a global
          attribute on an endpoint on all clusters. AttributePath = [[Attribute
          = Global Attribute, Endpoint = EndpointID ]]. +"
      verification: |
          The cluster used in the below command is an example, User can use any supported chip cluster/attribute/command.


          any subscribe-by-id 0xFFFFFFFF 0xFFFD  10 300 1 0 --keepSubscriptions true


          On TH(chip-tool) Verify that the Subscription succeeds and the DUT sends back the attribute values for the global attribute

          [1657451191.595630][11635:11640] CHIP:DMG:      InteractionModelRevision = 1
          [1657451191.595654][11635:11640] CHIP:DMG: }
          [1657451191.596003][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_0003 Attribute 0x0000_FFFD DataVersion: 1247215770
          [1657451191.596042][11635:11640] CHIP:TOO:   ClusterRevision: 4
          [1657451191.596102][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_0004 Attribute 0x0000_FFFD DataVersion: 3391062846
          [1657451191.596129][11635:11640] CHIP:TOO:   ClusterRevision: 4
          [1657451191.596187][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_001D Attribute 0x0000_FFFD DataVersion: 4071202320
          [1657451191.596214][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.596271][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_001E Attribute 0x0000_FFFD DataVersion: 2618211726
          [1657451191.596299][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.596356][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_001F Attribute 0x0000_FFFD DataVersion: 2563208108
          [1657451191.596382][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.596439][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_0028 Attribute 0x0000_FFFD DataVersion: 1504991228
          [1657451191.596466][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.596523][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_002A Attribute 0x0000_FFFD DataVersion: 3503114671
          [1657451191.596550][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.596607][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_002B Attribute 0x0000_FFFD DataVersion: 655424947
          [1657451191.596634][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.596691][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_002C Attribute 0x0000_FFFD DataVersion: 2421456926
          [1657451191.596717][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.596774][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_002D Attribute 0x0000_FFFD DataVersion: 3528791487
          [1657451191.596800][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.596857][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_002E Attribute 0x0000_FFFD DataVersion: 968449410
          [1657451191.596883][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.596940][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_002F Attribute 0x0000_FFFD DataVersion: 2811758882
          [1657451191.596967][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.597023][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_0030 Attribute 0x0000_FFFD DataVersion: 1035240738
          [1657451191.597050][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.597107][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_0031 Attribute 0x0000_FFFD DataVersion: 1760092942
          [1657451191.597133][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.597191][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_0032 Attribute 0x0000_FFFD DataVersion: 2220680799
          [1657451191.597217][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.597275][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_0033 Attribute 0x0000_FFFD DataVersion: 3326056069
          [1657451191.597301][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.597360][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_0034 Attribute 0x0000_FFFD DataVersion: 3433535141
          [1657451191.597386][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.597443][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_0035 Attribute 0x0000_FFFD DataVersion: 3003261549
          [1657451191.597470][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.597526][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_0036 Attribute 0x0000_FFFD DataVersion: 3106710214
          [1657451191.597553][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.597610][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_0037 Attribute 0x0000_FFFD DataVersion: 3053018824
          [1657451191.597637][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.597694][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003C Attribute 0x0000_FFFD DataVersion: 1257168122
          [1657451191.597721][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.597777][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003E Attribute 0x0000_FFFD DataVersion: 2262465581
          [1657451191.597804][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.597861][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003F Attribute 0x0000_FFFD DataVersion: 901334231
          [1657451191.597888][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.597945][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_0040 Attribute 0x0000_FFFD DataVersion: 4191161303
          [1657451191.597972][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.598030][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_0041 Attribute 0x0000_FFFD DataVersion: 2358987419
          [1657451191.598057][11635:11640] CHIP:TOO:   ClusterRevision: 1
          [1657451191.598114][11635:11640] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_0405 Attribute 0x0000_FFFD DataVersion: 2403664035
          [1657451191.598141][11635:11640] CHIP:TOO:   ClusterRevision: 3
          [1657451191.598261][11635:11640] CHIP:DMG: MoveToState ReadClient[0xffff94006d20]: Moving to [AwaitingSu]
          [1657451191.598325][11635:11640] CHIP:EM: Piggybacking Ack for MessageCounter:11055908 on exchange: 33634i
          [1657451191.598398][11635:11640] CHIP:IN: Prepared secure message 0xffff940026a8 to 0x0000000000000001 (1)  of type 0x1 and protocolId (0, 1) on exchange 33634i with MessageCounter:190733064.
          [1657451191.598437][11635:11640] CHIP:IN: Sending encrypted msg 0xffff940026a8 with MessageCounter:190733064 to 0x0000000000000001 (1) at monotonic time: 0000000000B5956B msec
          [1657451191.599445][11635:11640] CHIP:EM: Received message of type 0x4 with protocolId (0, 1) and MessageCounter:11055909 on exchange 33634i
          [1657451191.599480][11635:11640] CHIP:EM: Found matching exchange: 33634i, Delegate: 0xffff94006d20
          [1657451191.599517][11635:11640] CHIP:EM: Rxd Ack; Removing MessageCounter:190733064 from Retrans Table on exchange 33634i
          [1657451191.599544][11635:11640] CHIP:EM: Removed CHIP MessageCounter:190733064 from RetransTable on exchange 33634i
          [1657451191.599595][11635:11640] CHIP:DMG: SubscribeResponseMessage =
          [1657451191.599623][11635:11640] CHIP:DMG: {
          [1657451191.599647][11635:11640] CHIP:DMG:      SubscriptionId = 0x22d38d78,
          [1657451191.599674][11635:11640] CHIP:DMG:      MaxInterval = 0x12c,
          [1657451191.599700][11635:11640] CHIP:DMG:      InteractionModelRevision = 1
          [1657451191.599723][11635:11640] CHIP:DMG: }
          [1657451191.599751][11635:11640] CHIP:DMG: Subscription established with SubscriptionID = 0x22d38d78 MinInterval = 10s MaxInterval = 300s Peer = 01:0000000000000001
      disabled: true

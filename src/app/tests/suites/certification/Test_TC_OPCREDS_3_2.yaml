# Copyright (c) 2021 Project CHIP Authors
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# Auto-generated scripts for harness use only, please review before automation. The endpoints and cluster names are currently set to default

name:
    12.3.2. [TC-OPCREDS-3.2] Attribute-CurrentFabricIndex validation
    [DUT-Server]

PICS:
    - OPCREDS.S

config:
    nodeId: 0x12344321
    cluster: "Basic Information"
    endpoint: 0

tests:
    - label: "Precondition"
      verification: |
          This test case assumes that during Commissioning AddNOC will be sent with ICACValue
      disabled: true

    - label: "Factory Reset DUT"
      verification: |
          On both DUT and TH side use the below command
          sudo rm -rf /tmp/chip_*
      disabled: true

    - label:
          "Commission DUT to TH1s Fabric When DUT sends NOC response save
          FabricIndex as FabricIndex_TH1"
      verification: |
          DUT side:
          sudo ./chip-all-clusters-app --wifi

          TH side:
          ./chip-tool pairing ble-wifi 1 zigbeehome matter123 20202021 3841 --trace_decode 1

          [1650455358.501816][4366:4371] CHIP:TOO: Device commissioning completed with success"


          After commissioning DUT to TH1's fabric read nocs

          Verify the FabricIndex  value during commissioning in TH Log

          [1673248033.753372][1706:1708] CHIP:DMG: ICR moving to [AwaitingDe]
          [1673248033.754759][1706:1708] CHIP:DL: Avahi resolve found
          [1673248033.754878][1706:1708] CHIP:DIS: Node ID resolved for D6EE9064A90A31E6:0000000000000001
          [1673248033.754936][1706:1708] CHIP:DIS:         Hostname: E45F010EBE370000
          [1673248033.755001][1706:1708] CHIP:DIS:         IP Address #1: fe80::e65f:1ff:fe0e:be36
          [1673248033.755058][1706:1708] CHIP:DIS:         Port: 5540
          [1673248033.755112][1706:1708] CHIP:DIS:         Mrp Interval idle: not present
          [1673248033.755165][1706:1708] CHIP:DIS:         Mrp Interval active: not present
          [1673248033.755220][1706:1708] CHIP:DIS:         TCP Supported: 1
          [1673248033.755389][1706:1708] CHIP:DIS: UDP:[fe80::e65f:1ff:fe0e:be36%eth0]:5540: new best score: 3
          [1673248033.755415][1706:1708] CHIP:DIS: Checking node lookup status after 4 ms
          [1673248033.755435][1706:1708] CHIP:DIS: Keeping DNSSD lookup active
          [1673248033.951604][1706:1708] CHIP:DIS: Checking node lookup status after 200 ms
          [1673248033.951885][1706:1708] CHIP:DIS: OperationalSessionSetup[1:0000000000000001]: Updating device address to UDP:[fe80::e65f:1ff:fe0e:be36%eth0]:5540 while in state 2
          [1673248033.951950][1706:1708] CHIP:CTL: OperationalSessionSetup[1:0000000000000001]: State change 2 --> 3
          [1673248033.952156][1706:1708] CHIP:IN: SecureSession[0xffffa803fa40]: Allocated Type:2 LSID:14065
          [1673248033.952247][1706:1708] CHIP:SC: Initiating session on local FabricIndex 1 from 0x000000000001B669 -> 0x0000000000000001
          [1673248033.954558][1706:1708] CHIP:EM: <<< [E:44273i M:220413667] (U) Msg TX to 0:0000000000000000 [0000] --- Type 0000:30 (SecureChannel:CASE_Sigma1)
          [1673248033.954856][1706:1708] CHIP:IN: (U) Sending msg 220413667 to IP address 'UDP:[fe80::e65f:1ff:fe0e:be36%eth0]:5540'
          [1673248033.955496][1706:1708] CHIP:DMG: >> to UDP:[fe80::e65f:1ff:fe0e:be36%eth0]:5540 | 220413667 | [Secure Channel  (0) / Certificate Authenticated Session Establishment Sigma '1' (0x30) / Session = 0 / Exchange = 44273]
          [1673248033.955587][1706:1708] CHIP:DMG: Header Flags =
          [1673248033.955640][1706:1708] CHIP:DMG: {
          [1673248033.955707][1706:1708] CHIP:DMG:     Message (0x04) =
          [1673248033.955760][1706:1708] CHIP:DMG:     {
          [1673248033.955815][1706:1708] CHIP:DMG:         SourceNodeId = CC96A28E0D07DB60
          [1673248033.955866][1706:1708] CHIP:DMG:     }
          [1673248033.955936][1706:1708] CHIP:DMG:     Exchange (0x05) =
          [1673248033.955987][1706:1708] CHIP:DMG:     {
          [1673248033.956032][1706:1708] CHIP:DMG:         Initiator = true
          [1673248033.956083][1706:1708] CHIP:DMG:         NeedsAck = true
          [1673248033.956133][1706:1708] CHIP:DMG:     }
          [1673248033.956197][1706:1708] CHIP:DMG: }
      disabled: true

    - label: "Save TH1s Fabric ID as FabricID1"
      verification: |
          Refer the above step
      disabled: true

    - label:
          "Commission DUT to TH2s Fabric When DUT sends NOC response save
          FabricIndex as FabricIndex_TH2"
      verification: |
          To commission DUT to TH2 follow below procedure

          ./chip-tool  pairing open-commissioning-window 1 1 400 2000 3841  on TH

          Verify in TH2 Log:

          CHIP:IN: Sending encrypted msg 0xaaaad3464d10 with MessageCounter:0 to 0x0000000000000001 at monotonic time: 5805157 msec
          [1635691999.946536][3822:3827] CHIP:DMG: ICR moving to [CommandSen]
          [1635691999.946586][3822:3827] CHIP:CTL: Manual pairing code: [35407541839]
          [1635691999.946650][3822:3827] CHIP:CTL: SetupQRCode: [MT:00000CQM00G6V851H10]
          [1635691999.946802][3822:3827] CHIP:EM: Sending Standalone Ack for MessageCounter:3234931243 on exchange 35324i
          [1635691999.946850][3822:3827] CHIP:IN: Prepared plaintext message 0xffffaa58a960 to 0x0000000000000000 of type 0x10 and protocolId (0, 0) on exchange 35324i with MessageCounter:1726016118.
          [1635691999.946895][3822:3827] CHIP:IN: Sending plaintext msg 0xffffaa58a960 with MessageCounter:1726016118 to 0x0000000000000000 at monotonic time: 5805158 msec
          [1635691999.946983][3822:3827] CHIP:EM: Flushed pending ack for MessageCounter:3234931243 on exchange 35324i

          2. On 2nd controller, using chip-tool connect using manual code.
          Below is the example when using chip tool as controller (considering 35998938564 as the manual code generated by 1st controller)
          ./chip-tool pairing code 2 35407541839
          Verify whether you got below message in the log of TH
          Device commissioning completed with success

          After commissioning DUT to TH2's fabric read nocs

          Verify the FabricIndex  value during commissioning in TH2 Log

          [1673249259.162869][1742:1744] CHIP:CTL: Commissioning stage next step: 'SendNOC' -> 'FindOperational'
          [1673249259.162916][1742:1744] CHIP:CTL: Performing next commissioning step 'FindOperational'
          [1673249259.162950][1742:1744] CHIP:CSM: FindOrEstablishSession: PeerId = [2:0000000000000002]
          [1673249259.162984][1742:1744] CHIP:CSM: FindOrEstablishSession: No existing OperationalSessionSetup instance found
          [1673249259.163030][1742:1744] CHIP:CTL: OperationalSessionSetup[2:0000000000000002]: State change 1 --> 2
          [1673249259.163074][1742:1744] CHIP:DIS: Resolving 7046DDD750FF6301:0000000000000002 ...
          [1673249259.164602][1742:1744] CHIP:DMG: ICR moving to [AwaitingDe]
          [1673249259.164784][1742:1744] CHIP:EM: <<< [E:13994i M:120277250 (Ack:159284401)] (S) Msg TX to 0:FFFFFFFB00000000 [0000] --- Type 0000:10 (SecureChannel:StandaloneAck)
          [1673249259.164846][1742:1744] CHIP:IN: (S) Sending msg 120277250 on secure session with LSID: 60038
          [1673249259.165004][1742:1744] CHIP:EM: Flushed pending ack for MessageCounter:159284401 on exchange 13994i
          [1673249259.165571][1742:1744] CHIP:DL: Avahi resolve found
          [1673249259.165678][1742:1744] CHIP:DIS: Node ID resolved for 7046DDD750FF6301:0000000000000002
          [1673249259.165717][1742:1744] CHIP:DIS:         Hostname: E45F010EBE370000
          [1673249259.165760][1742:1744] CHIP:DIS:         IP Address #1: fe80::e65f:1ff:fe0e:be37
          [1673249259.165797][1742:1744] CHIP:DIS:         Port: 5540
          [1673249259.165832][1742:1744] CHIP:DIS:         Mrp Interval idle: not present
          [1673249259.165868][1742:1744] CHIP:DIS:         Mrp Interval active: not present
          [1673249259.165903][1742:1744] CHIP:DIS:         TCP Supported: 1
          [1673249259.166085][1742:1744] CHIP:DIS: UDP:[fe80::e65f:1ff:fe0e:be37%eth0]:5540: new best score: 3
          [1673249259.166126][1742:1744] CHIP:DIS: Checking node lookup status after 3 ms
          [1673249259.166158][1742:1744] CHIP:DIS: Keeping DNSSD lookup active
          [1673249259.362947][1742:1744] CHIP:DIS: Checking node lookup status after 200 ms
          [1673249259.363205][1742:1744] CHIP:DIS: OperationalSessionSetup[2:0000000000000002]: Updating device address to UDP:[fe80::e65f:1ff:fe0e:be37%eth0]:5540 while in state 2
          [1673249259.363267][1742:1744] CHIP:CTL: OperationalSessionSetup[2:0000000000000002]: State change 2 --> 3
          [1673249259.363467][1742:1744] CHIP:IN: SecureSession[0xffff98011400]: Allocated Type:2 LSID:60039
          [1673249259.363558][1742:1744] CHIP:SC: Initiating session on local FabricIndex 2 from 0x000000000001B669 -> 0x0000000000000002
          [1673249259.365555][1742:1744] CHIP:EM: <<< [E:13995i M:219921998] (U) Msg TX to 0:0000000000000000 [0000] --- Type 0000:30 (SecureChannel:CASE_Sigma1)
          [1673249259.365924][1742:1744] CHIP:IN: (U) Sending msg 219921998 to IP address 'UDP:[fe80::e65f:1ff:fe0e:be37%eth0]:5540'
          [1673249259.366260][1742:1744] CHIP:SC: Sent Sigma1 msg
          [1673249259.366326][1742:1744] CHIP:CTL: OperationalSessionSetup[2:0000000000000002]: State change 3 --> 4
          [1673249259.439277][1742:1744] CHIP:EM: >>> [E:13995i M:53416131 (Ack:219921998)] (U) Msg RX from 0:0000000000000000 [0000] --- Type 0000:31 (SecureChannel:CASE_Sigma2)
          [1673249259.439370][1742:1744] CHIP:EM: Found matching exchange: 13995i, Delegate: 0xffff9803b498
          [1673249259.439446][1742:1744] CHIP:EM: Rxd Ack; Removing MessageCounter:219921998 from Retrans Table on exchange 13995i
          [1673249259.439525][1742:1744] CHIP:SC: Received Sigma2 msg
      disabled: true

    - label: "Save TH2s Fabric ID as FabricID2"
      verification: |
          Refer the above step
      disabled: true

    - label: "From TH1 read the CurrentFabricIndex"
      PICS: OPCREDS.S.A0005
      verification: |
          ./chip-tool operationalcredentials read   current-fabric-index   1 0

          Verify the current fabric index in TH Log

          CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003E Attribute 0x0000_0005 DataVersion: 2445178920
          CHIP:TOO:   CurrentFabricIndex: 1
          CHIP:EM: Sending Standalone Ack for MessageCounter:7141893 on exchange 26909i
      disabled: true

    - label: "Verify that CurrentFabricIndex = FabricIndex_TH1"
      verification: |
          Verify that CurrentFabricIndex = FabricIndex_TH1
      disabled: true

    - label:
          "From TH1 read the entire NOCs List attribute with a
          non-fabric-filtered read"
      verification: |
          ./chip-tool operationalcredentials read nocs 1 0

          Verify the NOCs List in TH Log

          [1658819541.245848][8318:8323] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003E Attribute 0x0000_0000 DataVersion: 2645922631
          [1658819541.245960][8318:8323] CHIP:TOO:   NOCs: 1 entries
          [1658819541.246062][8318:8323] CHIP:TOO:     [1]: {
          [1658819541.246104][8318:8323] CHIP:TOO:       Noc: 1530010101240201370324130118260480228127260580254D3A37062415012411011824070124080130094104945BB6D314004535F064257DB78A569D050056ECBCA9B5DCFAA49328141D073AC97D1C9D2156F4ECC87D3C876F51A36589924DCFD91171AB4E99CB9072B545A9370A350128011824020136030402040118300414F22D910BF2B1CEDB6010239731FD43C440465A99300514F994AD9E2B006BA9C1276D20CB27A4F1212BC98B18300B40A1D2495C0AC15812710D1A37E47B3DBD190EE886A84904087B2094FA21E85BBF580C7D934B898878EBF209F93E06F785BEA2A10FC84064D5DF976FEF2CADBCCC18
          [1658819541.246163][8318:8323] CHIP:TOO:       Icac: 1530010100240201370324140018260480228127260580254D3A370624130118240701240801300941045C9D561F53AAB6D9473DF2EE5170B03332BC38EF461842C37954CE99ADC4D55B272B3E545BB9FB2440CB712BA70BDDE27A318BEE1348D5F8C2D2C98CDBAD63C9370A3501290118240260300414F994AD9E2B006BA9C1276D20CB27A4F1212BC98B3005149040FBAF6F57D4E32188CD360DD4959272745D7618300B40C5EFCC41A18A4FAD6B1DAE6B12675D0C3FF1690728C31D1E95629511F23A4336DB5392E1FEF05EF1BA1DA46080A29BAB60EC613DEF031E2ED9850BB2E3B48B1118
          [1658819541.246198][8318:8323] CHIP:TOO:       FabricIndex: 1
          [1658819541.246224][8318:8323] CHIP:TOO:      }
      disabled: true

    - label:
          "Verify that there is only data for the entry whose FabricIndex field
          is equal to FabricIndex_TH1"
      verification: |
          Verify that Noc"s list has only data for FabricIndex_TH1

          [1658819541.245848][8318:8323] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003E Attribute 0x0000_0000 DataVersion: 2645922631
          [1658819541.245960][8318:8323] CHIP:TOO:   NOCs: 1 entries
          [1658819541.246062][8318:8323] CHIP:TOO:     [1]: {
          [1658819541.246104][8318:8323] CHIP:TOO:       Noc: 1530010101240201370324130118260480228127260580254D3A37062415012411011824070124080130094104945BB6D314004535F064257DB78A569D050056ECBCA9B5DCFAA49328141D073AC97D1C9D2156F4ECC87D3C876F51A36589924DCFD91171AB4E99CB9072B545A9370A350128011824020136030402040118300414F22D910BF2B1CEDB6010239731FD43C440465A99300514F994AD9E2B006BA9C1276D20CB27A4F1212BC98B18300B40A1D2495C0AC15812710D1A37E47B3DBD190EE886A84904087B2094FA21E85BBF580C7D934B898878EBF209F93E06F785BEA2A10FC84064D5DF976FEF2CADBCCC18
          [1658819541.246163][8318:8323] CHIP:TOO:       Icac: 1530010100240201370324140018260480228127260580254D3A370624130118240701240801300941045C9D561F53AAB6D9473DF2EE5170B03332BC38EF461842C37954CE99ADC4D55B272B3E545BB9FB2440CB712BA70BDDE27A318BEE1348D5F8C2D2C98CDBAD63C9370A3501290118240260300414F994AD9E2B006BA9C1276D20CB27A4F1212BC98B3005149040FBAF6F57D4E32188CD360DD4959272745D7618300B40C5EFCC41A18A4FAD6B1DAE6B12675D0C3FF1690728C31D1E95629511F23A4336DB5392E1FEF05EF1BA1DA46080A29BAB60EC613DEF031E2ED9850BB2E3B48B1118
          [1658819541.246198][8318:8323] CHIP:TOO:       FabricIndex: 1
          [1658819541.246224][8318:8323] CHIP:TOO:      }
      disabled: true

    - label:
          "From TH1 read the entire NOCs List attribute with a fabric-filtered
          read"
      verification: |
          ./chip-tool operationalcredentials read nocs 1 0 --fabric-filtered 1

          Verify the NOCs List in TH Log

          [1658819590.504973][8327:8332] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003E Attribute 0x0000_0000 DataVersion: 2645922631
          [1658819590.505058][8327:8332] CHIP:TOO:   NOCs: 1 entries
          [1658819590.505131][8327:8332] CHIP:TOO:     [1]: {
          [1658819590.505173][8327:8332] CHIP:TOO:       Noc: 1530010101240201370324130118260480228127260580254D3A37062415012411011824070124080130094104945BB6D314004535F064257DB78A569D050056ECBCA9B5DCFAA49328141D073AC97D1C9D2156F4ECC87D3C876F51A36589924DCFD91171AB4E99CB9072B545A9370A350128011824020136030402040118300414F22D910BF2B1CEDB6010239731FD43C440465A99300514F994AD9E2B006BA9C1276D20CB27A4F1212BC98B18300B40A1D2495C0AC15812710D1A37E47B3DBD190EE886A84904087B2094FA21E85BBF580C7D934B898878EBF209F93E06F785BEA2A10FC84064D5DF976FEF2CADBCCC18
          [1658819590.505232][8327:8332] CHIP:TOO:       Icac: 1530010100240201370324140018260480228127260580254D3A370624130118240701240801300941045C9D561F53AAB6D9473DF2EE5170B03332BC38EF461842C37954CE99ADC4D55B272B3E545BB9FB2440CB712BA70BDDE27A318BEE1348D5F8C2D2C98CDBAD63C9370A3501290118240260300414F994AD9E2B006BA9C1276D20CB27A4F1212BC98B3005149040FBAF6F57D4E32188CD360DD4959272745D7618300B40C5EFCC41A18A4FAD6B1DAE6B12675D0C3FF1690728C31D1E95629511F23A4336DB5392E1FEF05EF1BA1DA46080A29BAB60EC613DEF031E2ED9850BB2E3B48B1118
          [1658819590.505266][8327:8332] CHIP:TOO:       FabricIndex: 1
          [1658819590.505292][8327:8332] CHIP:TOO:      }
      disabled: true

    - label:
          "Verify that there is only data for the entry whose FabricIndex field
          is equal to FabricIndex_TH1"
      verification: |
          Verify that Noc"s list has only data for FabricIndex_TH1

          [1658819590.504973][8327:8332] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003E Attribute 0x0000_0000 DataVersion: 2645922631
          [1658819590.505058][8327:8332] CHIP:TOO:   NOCs: 1 entries
          [1658819590.505131][8327:8332] CHIP:TOO:     [1]: {
          [1658819590.505173][8327:8332] CHIP:TOO:       Noc: 1530010101240201370324130118260480228127260580254D3A37062415012411011824070124080130094104945BB6D314004535F064257DB78A569D050056ECBCA9B5DCFAA49328141D073AC97D1C9D2156F4ECC87D3C876F51A36589924DCFD91171AB4E99CB9072B545A9370A350128011824020136030402040118300414F22D910BF2B1CEDB6010239731FD43C440465A99300514F994AD9E2B006BA9C1276D20CB27A4F1212BC98B18300B40A1D2495C0AC15812710D1A37E47B3DBD190EE886A84904087B2094FA21E85BBF580C7D934B898878EBF209F93E06F785BEA2A10FC84064D5DF976FEF2CADBCCC18
          [1658819590.505232][8327:8332] CHIP:TOO:       Icac: 1530010100240201370324140018260480228127260580254D3A370624130118240701240801300941045C9D561F53AAB6D9473DF2EE5170B03332BC38EF461842C37954CE99ADC4D55B272B3E545BB9FB2440CB712BA70BDDE27A318BEE1348D5F8C2D2C98CDBAD63C9370A3501290118240260300414F994AD9E2B006BA9C1276D20CB27A4F1212BC98B3005149040FBAF6F57D4E32188CD360DD4959272745D7618300B40C5EFCC41A18A4FAD6B1DAE6B12675D0C3FF1690728C31D1E95629511F23A4336DB5392E1FEF05EF1BA1DA46080A29BAB60EC613DEF031E2ED9850BB2E3B48B1118
          [1658819590.505266][8327:8332] CHIP:TOO:       FabricIndex: 1
          [1658819590.505292][8327:8332] CHIP:TOO:      }
      disabled: true

    - label: "Read NOCStruct values from entry at index 0"
      verification: |
          ./chip-tool operationalcredentials read nocs 1 0 --fabric-filtered 1

          Verify FabricIndex field equal to FabricIndex_TH1 in TH Log

          [1658819590.504973][8327:8332] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003E Attribute 0x0000_0000 DataVersion: 2645922631
          [1658819590.505058][8327:8332] CHIP:TOO:   NOCs: 1 entries
          [1658819590.505131][8327:8332] CHIP:TOO:     [1]: {
          [1658819590.505173][8327:8332] CHIP:TOO:       Noc: 1530010101240201370324130118260480228127260580254D3A37062415012411011824070124080130094104945BB6D314004535F064257DB78A569D050056ECBCA9B5DCFAA49328141D073AC97D1C9D2156F4ECC87D3C876F51A36589924DCFD91171AB4E99CB9072B545A9370A350128011824020136030402040118300414F22D910BF2B1CEDB6010239731FD43C440465A99300514F994AD9E2B006BA9C1276D20CB27A4F1212BC98B18300B40A1D2495C0AC15812710D1A37E47B3DBD190EE886A84904087B2094FA21E85BBF580C7D934B898878EBF209F93E06F785BEA2A10FC84064D5DF976FEF2CADBCCC18
          [1658819590.505232][8327:8332] CHIP:TOO:       Icac: 1530010100240201370324140018260480228127260580254D3A370624130118240701240801300941045C9D561F53AAB6D9473DF2EE5170B03332BC38EF461842C37954CE99ADC4D55B272B3E545BB9FB2440CB712BA70BDDE27A318BEE1348D5F8C2D2C98CDBAD63C9370A3501290118240260300414F994AD9E2B006BA9C1276D20CB27A4F1212BC98B3005149040FBAF6F57D4E32188CD360DD4959272745D7618300B40C5EFCC41A18A4FAD6B1DAE6B12675D0C3FF1690728C31D1E95629511F23A4336DB5392E1FEF05EF1BA1DA46080A29BAB60EC613DEF031E2ED9850BB2E3B48B1118
          [1658819590.505266][8327:8332] CHIP:TOO:       FabricIndex: 1
          [1658819590.505292][8327:8332] CHIP:TOO:      }
      disabled: true

    - label:
          "From the NOCStruct values verify the following: NOC matches the NOC
          sent to the DUT during commissioning process ICAC matches the ICAC
          sent to the DUT during commissioning process from AddNOC in
          pre-condition"
      verification: |
          Verify NOC and ICAC value in step 12 and 2 matches

          NOC value of step 12
          Noc: 1530010101240201370324130118260480228127260580254D3A37062415012411011824070124080130094104945BB6D314004535F064257DB78A569D050056ECBCA9B5DCFAA49328141D073AC97D1C9D2156F4ECC87D3C876F51A36589924DCFD91171AB4E99CB9072B545A9370A350128011824020136030402040118300414F22D910BF2B1CEDB6010239731FD43C440465A99300514F994AD9E2B006BA9C1276D20CB27A4F1212BC98B18300B40A1D2495C0AC15812710D1A37E47B3DBD190EE886A84904087B2094FA21E85BBF580C7D934B898878EBF209F93E06F785BEA2A10FC84064D5DF976FEF2CADBCCC18

          NOC value of Step 2

          0x15, 0x30, 0x1, 0x1, 0x1, 0x24, 0x2, 0x1, 0x37, 0x3, 0x24, 0x13, 0x1, 0x18, 0x26, 0x4, 0x80, 0x22, 0x81, 0x27, 0x26, 0x5, 0x80, 0x25, 0x4d, 0x3a, 0x37, 0x6, 0x24, 0x15, 0x1, 0x24, 0x11, 0x1, 0x18, 0x24, 0x7, 0x1, 0x24, 0x8, 0x1, 0x30, 0x9, 0x41, 0x4, 0x94, 0x5b, 0xb6, 0xd3, 0x14, 0x0, 0x45, 0x35, 0xf0, 0x64, 0x25, 0x7d, 0xb7, 0x8a, 0x56, 0x9d, 0x5, 0x0, 0x56, 0xec, 0xbc, 0xa9, 0xb5, 0xdc, 0xfa, 0xa4, 0x93, 0x28, 0x14, 0x1d, 0x7, 0x3a, 0xc9, 0x7d, 0x1c, 0x9d, 0x21, 0x56, 0xf4, 0xec, 0xc8, 0x7d, 0x3c, 0x87, 0x6f, 0x51, 0xa3, 0x65, 0x89, 0x92, 0x4d, 0xcf, 0xd9, 0x11, 0x71, 0xab, 0x4e, 0x99, 0xcb, 0x90, 0x72, 0xb5, 0x45, 0xa9, 0x37, 0xa, 0x35, 0x1, 0x28, 0x1, 0x18, 0x24, 0x2, 0x1, 0x36, 0x3, 0x4, 0x2, 0x4, 0x1, 0x18, 0x30, 0x4, 0x14, 0xf2, 0x2d, 0x91, 0xb, 0xf2, 0xb1, 0xce, 0xdb, 0x60, 0x10, 0x23, 0x97, 0x31, 0xfd, 0x43, 0xc4, 0x40, 0x46, 0x5a, 0x99, 0x30, 0x5, 0x14, 0xf9, 0x94, 0xad, 0x9e, 0x2b, 0x0, 0x6b, 0xa9, 0xc1, 0x27, 0x6d, 0x20, 0xcb, 0x27, 0xa4, 0xf1, 0x21, 0x2b, 0xc9, 0x8b, 0x18, 0x30, 0xb, 0x40, 0xa1, 0xd2, 0x49, 0x5c, 0xa, 0xc1, 0x58, 0x12, 0x71, 0xd, 0x1a, 0x37, 0xe4, 0x7b, 0x3d, 0xbd, 0x19, 0xe, 0xe8, 0x86, 0xa8, 0x49, 0x4, 0x8, 0x7b, 0x20, 0x94, 0xfa, 0x21, 0xe8, 0x5b, 0xbf, 0x58, 0xc, 0x7d, 0x93, 0x4b, 0x89, 0x88, 0x78, 0xeb, 0xf2, 0x9, 0xf9, 0x3e, 0x6, 0xf7, 0x85, 0xbe, 0xa2, 0xa1, 0xf, 0xc8, 0x40, 0x64, 0xd5, 0xdf, 0x97, 0x6f, 0xef, 0x2c, 0xad, 0xbc, 0xcc, 0x18,
      disabled: true

    - label:
          "Read the Fabrics List and get the FabricDescriptorStruct for the
          entry where FabricIndex = FabricIndex_TH1 from DUT"
      verification: |
          ./chip-tool operationalcredentials read fabrics 1 0

          Verify FabricIndex = FabricIndex_TH1 in TH Log

          [1657693240.722099][15129:15134] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003E Attribute 0x0000_0001 DataVersion: 908345149
          [1657693240.722200][15129:15134] CHIP:TOO:   Fabrics: 1 entries
          [1657693240.722273][15129:15134] CHIP:TOO:     [1]: {
          [1657693240.722316][15129:15134] CHIP:TOO:       RootPublicKey: 04038A93AE14428E9179C2ACC3BA1522D4D19BC20A3203BE97FEC0BE47EBC6CCCD4AD5F7B1CE0A02F85FF1B14216FAFCA034B3B312C16B0517267804D5B03582EF
          [1657693240.722368][15129:15134] CHIP:TOO:       VendorId: 65521
          [1657693240.722401][15129:15134] CHIP:TOO:       FabricId: 1
          [1657693240.722431][15129:15134] CHIP:TOO:       NodeId: 1
          [1657693240.722462][15129:15134] CHIP:TOO:       Label:
          [1657693240.722492][15129:15134] CHIP:TOO:       FabricIndex: 1
          [1657693240.722522][15129:15134] CHIP:TOO:      }
      disabled: true

    - label:
          "Verify that TH1 is able to read the FabricDescriptorStruct values
          Verify that Fabrics list does not have any entry as FabricID =
          FabricID2"
      verification: |
          Verify the FabricDescriptorStruct values has no entry log FabricID2 on TH1

          [1657693240.722099][15129:15134] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003E Attribute 0x0000_0001 DataVersion: 908345149
          [1657693240.722200][15129:15134] CHIP:TOO:   Fabrics: 1 entries
          [1657693240.722273][15129:15134] CHIP:TOO:     [1]: {
          [1657693240.722316][15129:15134] CHIP:TOO:       RootPublicKey: 04038A93AE14428E9179C2ACC3BA1522D4D19BC20A3203BE97FEC0BE47EBC6CCCD4AD5F7B1CE0A02F85FF1B14216FAFCA034B3B312C16B0517267804D5B03582EF
          [1657693240.722368][15129:15134] CHIP:TOO:       VendorId: 65521
          [1657693240.722401][15129:15134] CHIP:TOO:       FabricId: 1
          [1657693240.722431][15129:15134] CHIP:TOO:       NodeId: 1
          [1657693240.722462][15129:15134] CHIP:TOO:       Label:
          [1657693240.722492][15129:15134] CHIP:TOO:       FabricIndex: 1
          [1657693240.722522][15129:15134] CHIP:TOO:      }
      disabled: true

    - label: "From TH2 read the CurrentFabricIndex"
      verification: |
          ./chip-tool operationalcredentials read   current-fabric-index 2 0

          Verify current fabric index in TH2 Log

          CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003E Attribute 0x0000_0005 DataVersion: 2445178920
          CHIP:TOO:   CurrentFabricIndex: 2
          CHIP:EM: Sending Standalone Ack for MessageCounter:8900122 on exchange 26519i
      disabled: true

    - label: "Verify that CurrentFabricIndex = FabricIndex_TH2"
      verification: |
          Verify that CurrentFabricIndex = FabricIndex_TH2
      disabled: true

    - label:
          "From TH2 read the entire NOCs List attribute with a
          non-fabric-filtered read"
      verification: |
          ./chip-tool operationalcredentials read nocs 2 0


          Verify the NOCs List in TH2 Log

          [1658819643.546022][8397:8402] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003E Attribute 0x0000_0000 DataVersion: 2645922631
          [1658819643.546148][8397:8402] CHIP:TOO:   NOCs: 1 entries
          [1658819643.546258][8397:8402] CHIP:TOO:     [1]: {
          [1658819643.546307][8397:8402] CHIP:TOO:       Noc: 1530010101240201370324130118260480228127260580254D3A37062415012411021824070124080130094104FF8D28DB36902F674F4BF312985CDEA52231E0B3C4795E54E3EFC0D6DE9AED140DEF653EDE9160B10BF446D6E2FAC5DBD38BF85597E095136A209F0990E54394370A3501280118240201360304020401183004144F0F08EA1F5414C324914019EB74CA31C9819AC6300514FF5D080583B5B132C45F800B8D2E184E7D599F5118300B40D434A0D9DA1C7D61784D8BCBEE3E7179A4818499442DD23919A81933C0170673FF33D0E8654312388EE717161DF5E1B6E14402380602B873D551174B2BA0D8E718
          [1658819643.546407][8397:8402] CHIP:TOO:       Icac: 1530010100240201370324140018260480228127260580254D3A37062413011824070124080130094104A58C57E9D8919152DE03DAC991155D750A5D8C93093D75E166E1C5CF86381EA926E108BFE78DAD9FFFB4363A706DA88B9F3B8EF5D80F428F44EAE26472C81B47370A3501290118240260300414FF5D080583B5B132C45F800B8D2E184E7D599F513005143036AAD3B8EDBF6075364A85A96F9A0583EEC49718300B4014BEAF33C7B547857AC36A17AD1CDD4D90D7045889C5B576CA644C78F021B6C21498EDDC43730AFEAD6AF5A945728D1C4F7DF7EE37C313D5AE27E78F0509DB9918
          [1658819643.546447][8397:8402] CHIP:TOO:       FabricIndex: 2
          [1658819643.546478][8397:8402] CHIP:TOO:      }
      disabled: true

    - label:
          "Verify that there is only data for the entry whose FabricIndex field
          is equal to FabricIndex_TH2"
      verification: |
          ./chip-tool operationalcredentials read   current-fabric-index 2 0

          Verify current fabric index in TH2 Log

          CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003E Attribute 0x0000_0005 DataVersion: 2445178920
          CHIP:TOO:   CurrentFabricIndex: 2
          CHIP:EM: Sending Standalone Ack for MessageCounter:8900122 on exchange 26519i
      disabled: true

    - label:
          "From TH2 read the entire NOCs List attribute with a fabric-filtered
          read"
      verification: |
          ./chip-tool operationalcredentials read nocs 2 0 --fabric-filtered 1


          Verify the NOCs List in TH2 Log

          [1658819643.546022][8397:8402] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003E Attribute 0x0000_0000 DataVersion: 2645922631
          [1658819643.546148][8397:8402] CHIP:TOO:   NOCs: 1 entries
          [1658819643.546258][8397:8402] CHIP:TOO:     [1]: {
          [1658819643.546307][8397:8402] CHIP:TOO:       Noc: 1530010101240201370324130118260480228127260580254D3A37062415012411021824070124080130094104FF8D28DB36902F674F4BF312985CDEA52231E0B3C4795E54E3EFC0D6DE9AED140DEF653EDE9160B10BF446D6E2FAC5DBD38BF85597E095136A209F0990E54394370A3501280118240201360304020401183004144F0F08EA1F5414C324914019EB74CA31C9819AC6300514FF5D080583B5B132C45F800B8D2E184E7D599F5118300B40D434A0D9DA1C7D61784D8BCBEE3E7179A4818499442DD23919A81933C0170673FF33D0E8654312388EE717161DF5E1B6E14402380602B873D551174B2BA0D8E718
          [1658819643.546407][8397:8402] CHIP:TOO:       Icac: 1530010100240201370324140018260480228127260580254D3A37062413011824070124080130094104A58C57E9D8919152DE03DAC991155D750A5D8C93093D75E166E1C5CF86381EA926E108BFE78DAD9FFFB4363A706DA88B9F3B8EF5D80F428F44EAE26472C81B47370A3501290118240260300414FF5D080583B5B132C45F800B8D2E184E7D599F513005143036AAD3B8EDBF6075364A85A96F9A0583EEC49718300B4014BEAF33C7B547857AC36A17AD1CDD4D90D7045889C5B576CA644C78F021B6C21498EDDC43730AFEAD6AF5A945728D1C4F7DF7EE37C313D5AE27E78F0509DB9918
          [1658819643.546447][8397:8402] CHIP:TOO:       FabricIndex: 2
          [1658819643.546478][8397:8402] CHIP:TOO:      }
      disabled: true

    - label:
          "Verify that there is only data for the entry whose FabricIndex field
          is equal to FabricIndex_TH2"
      verification: |
          Verify that Noc"s list has only data for FabricIndex_TH2

          [1658819643.546022][8397:8402] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003E Attribute 0x0000_0000 DataVersion: 2645922631
          [1658819643.546148][8397:8402] CHIP:TOO:   NOCs: 1 entries
          [1658819643.546258][8397:8402] CHIP:TOO:     [1]: {
          [1658819643.546307][8397:8402] CHIP:TOO:       Noc: 1530010101240201370324130118260480228127260580254D3A37062415012411021824070124080130094104FF8D28DB36902F674F4BF312985CDEA52231E0B3C4795E54E3EFC0D6DE9AED140DEF653EDE9160B10BF446D6E2FAC5DBD38BF85597E095136A209F0990E54394370A3501280118240201360304020401183004144F0F08EA1F5414C324914019EB74CA31C9819AC6300514FF5D080583B5B132C45F800B8D2E184E7D599F5118300B40D434A0D9DA1C7D61784D8BCBEE3E7179A4818499442DD23919A81933C0170673FF33D0E8654312388EE717161DF5E1B6E14402380602B873D551174B2BA0D8E718
          [1658819643.546407][8397:8402] CHIP:TOO:       Icac: 1530010100240201370324140018260480228127260580254D3A37062413011824070124080130094104A58C57E9D8919152DE03DAC991155D750A5D8C93093D75E166E1C5CF86381EA926E108BFE78DAD9FFFB4363A706DA88B9F3B8EF5D80F428F44EAE26472C81B47370A3501290118240260300414FF5D080583B5B132C45F800B8D2E184E7D599F513005143036AAD3B8EDBF6075364A85A96F9A0583EEC49718300B4014BEAF33C7B547857AC36A17AD1CDD4D90D7045889C5B576CA644C78F021B6C21498EDDC43730AFEAD6AF5A945728D1C4F7DF7EE37C313D5AE27E78F0509DB9918
          [1658819643.546447][8397:8402] CHIP:TOO:       FabricIndex: 2
          [1658819643.546478][8397:8402] CHIP:TOO:      }
      disabled: true

    - label: "Read NOCStruct values from entry at index 1"
      verification: |
          ./chip-tool operationalcredentials read nocs 2 0

          Verify FabricIndex = FabricIndex_TH2 in TH2 Log

          [1658819643.546022][8397:8402] CHIP:TOO: Endpoint: 0 Cluster: 0x0000_003E Attribute 0x0000_0000 DataVersion: 2645922631
          [1658819643.546148][8397:8402] CHIP:TOO:   NOCs: 1 entries
          [1658819643.546258][8397:8402] CHIP:TOO:     [1]: {
          [1658819643.546307][8397:8402] CHIP:TOO:       Noc: 1530010101240201370324130118260480228127260580254D3A37062415012411021824070124080130094104FF8D28DB36902F674F4BF312985CDEA52231E0B3C4795E54E3EFC0D6DE9AED140DEF653EDE9160B10BF446D6E2FAC5DBD38BF85597E095136A209F0990E54394370A3501280118240201360304020401183004144F0F08EA1F5414C324914019EB74CA31C9819AC6300514FF5D080583B5B132C45F800B8D2E184E7D599F5118300B40D434A0D9DA1C7D61784D8BCBEE3E7179A4818499442DD23919A81933C0170673FF33D0E8654312388EE717161DF5E1B6E14402380602B873D551174B2BA0D8E718
          [1658819643.546407][8397:8402] CHIP:TOO:       Icac: 1530010100240201370324140018260480228127260580254D3A37062413011824070124080130094104A58C57E9D8919152DE03DAC991155D750A5D8C93093D75E166E1C5CF86381EA926E108BFE78DAD9FFFB4363A706DA88B9F3B8EF5D80F428F44EAE26472C81B47370A3501290118240260300414FF5D080583B5B132C45F800B8D2E184E7D599F513005143036AAD3B8EDBF6075364A85A96F9A0583EEC49718300B4014BEAF33C7B547857AC36A17AD1CDD4D90D7045889C5B576CA644C78F021B6C21498EDDC43730AFEAD6AF5A945728D1C4F7DF7EE37C313D5AE27E78F0509DB9918
          [1658819643.546447][8397:8402] CHIP:TOO:       FabricIndex: 2
          [1658819643.546478][8397:8402] CHIP:TOO:      }
      disabled: true

    - label:
          "From the NOCStruct values verify the following: NOC matches the NOC
          sent to the DUT during commissioning process ICAC matches the ICAC
          sent to the DUT during commissioning process from AddNOC in
          pre-condition"
      verification: |
          Verify the value of NOC and ICAC are same in step 22 and 4 are same

          Step 22 Log:
           Noc: 1530010101240201370324130118260480228127260580254D3A37062415012411021824070124080130094104FF8D28DB36902F674F4BF312985CDEA52231E0B3C4795E54E3EFC0D6DE9AED140DEF653EDE9160B10BF446D6E2FAC5DBD38BF85597E095136A209F0990E54394370A3501280118240201360304020401183004144F0F08EA1F5414C324914019EB74CA31C9819AC6300514FF5D080583B5B132C45F800B8D2E184E7D599F5118300B40D434A0D9DA1C7D61784D8BCBEE3E7179A4818499442DD23919A81933C0170673FF33D0E8654312388EE717161DF5E1B6E14402380602B873D551174B2BA0D8E718

          Step 4 Log
           0x15, 0x30, 0x1, 0x1, 0x1, 0x24, 0x2, 0x1, 0x37, 0x3, 0x24, 0x13, 0x1, 0x18, 0x26, 0x4, 0x80, 0x22, 0x81, 0x27, 0x26, 0x5, 0x80, 0x25, 0x4d, 0x3a, 0x37, 0x6, 0x24, 0x15, 0x1, 0x24, 0x11, 0x2, 0x18, 0x24, 0x7, 0x1, 0x24, 0x8, 0x1, 0x30, 0x9, 0x41, 0x4, 0xff, 0x8d, 0x28, 0xdb, 0x36, 0x90, 0x2f, 0x67, 0x4f, 0x4b, 0xf3, 0x12, 0x98, 0x5c, 0xde, 0xa5, 0x22, 0x31, 0xe0, 0xb3, 0xc4, 0x79, 0x5e, 0x54, 0xe3, 0xef, 0xc0, 0xd6, 0xde, 0x9a, 0xed, 0x14, 0xd, 0xef, 0x65, 0x3e, 0xde, 0x91, 0x60, 0xb1, 0xb, 0xf4, 0x46, 0xd6, 0xe2, 0xfa, 0xc5, 0xdb, 0xd3, 0x8b, 0xf8, 0x55, 0x97, 0xe0, 0x95, 0x13, 0x6a, 0x20, 0x9f, 0x9, 0x90, 0xe5, 0x43, 0x94, 0x37, 0xa, 0x35, 0x1, 0x28, 0x1, 0x18, 0x24, 0x2, 0x1, 0x36, 0x3, 0x4, 0x2, 0x4, 0x1, 0x18, 0x30, 0x4, 0x14, 0x4f, 0xf, 0x8, 0xea, 0x1f, 0x54, 0x14, 0xc3, 0x24, 0x91, 0x40, 0x19, 0xeb, 0x74, 0xca, 0x31, 0xc9, 0x81, 0x9a, 0xc6, 0x30, 0x5, 0x14, 0xff, 0x5d, 0x8, 0x5, 0x83, 0xb5, 0xb1, 0x32, 0xc4, 0x5f, 0x80, 0xb, 0x8d, 0x2e, 0x18, 0x4e, 0x7d, 0x59, 0x9f, 0x51, 0x18, 0x30, 0xb, 0x40, 0xd4, 0x34, 0xa0, 0xd9, 0xda, 0x1c, 0x7d, 0x61, 0x78, 0x4d, 0x8b, 0xcb, 0xee, 0x3e, 0x71, 0x79, 0xa4, 0x81, 0x84, 0x99, 0x44, 0x2d, 0xd2, 0x39, 0x19, 0xa8, 0x19, 0x33, 0xc0, 0x17, 0x6, 0x73, 0xff, 0x33, 0xd0, 0xe8, 0x65, 0x43, 0x12, 0x38, 0x8e, 0xe7, 0x17, 0x16, 0x1d, 0xf5, 0xe1, 0xb6, 0xe1, 0x44, 0x2, 0x38, 0x6, 0x2, 0xb8, 0x73, 0xd5, 0x51, 0x17, 0x4b, 0x2b, 0xa0, 0xd8, 0xe7, 0x18,
      disabled: true

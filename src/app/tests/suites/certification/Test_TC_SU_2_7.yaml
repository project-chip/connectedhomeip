# Copyright (c) 2021 Project CHIP Authors
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

name: 31.8.1. [TC-SU-2.7] Tests Events generated by OTA-R(DUT)

config:
    nodeId: 0x12344321
    cluster: "Basic"
    endpoint: 0

tests:
    - label: "DUT sends a software update Query to the OTA-P."
      verification:
          "chip-tool otasoftwareupdaterequestor announce-ota-provider 0xDEADBEEF
          0 0 0 0x1234567890 0 where 0x1234567890 is OTA Requestor node ID and
          0xDEADBEEF is OTA Provider node ID Subscribe to StateTransition event
          right away after this using command chip-tool
          otasoftwareupdaterequestor subscribe-event state-transition 5 10 1 2 0
          Verify that the chip-tool receives below StateTransition event
          notifications 1644017070772] [33044:1032132] CHIP: [TOO]
          StateTransition: { [1644017070772] [33044:1032132] CHIP: [TOO]
          PreviousState: 1 [1644017070772] [33044:1032132] CHIP: [TOO] NewState:
          2 [1644017070772] [33044:1032132] CHIP: [TOO] Reason: 1
          [1644017070772] [33044:1032132] CHIP: [TOO] TargetSoftwareVersion:
          null [1644017070772] [33044:1032132] CHIP: [TOO] } [1644017070772]
          [33044:1032132] CHIP: [TOO] StateTransition: { [1644017070772]
          [33044:1032132] CHIP: [TOO] PreviousState: 2 [1644017070772]
          [33044:1032132] CHIP: [TOO] NewState: 4 [1644017070772]
          [33044:1032132] CHIP: [TOO] Reason: 1 [1644017070772] [33044:1032132]
          CHIP: [TOO] TargetSoftwareVersion: 1 [1644017070772] [33044:1032132]
          CHIP: [TOO] } [1644017080776] [33044:1032131] CHIP: [TOO]
          StateTransition: { [1644017080776] [33044:1032131] CHIP: [TOO]
          PreviousState: 4 [1644017080776] [33044:1032131] CHIP: [TOO] NewState:
          5 [1644017080776] [33044:1032131] CHIP: [TOO] Reason: 1
          [1644017080776] [33044:1032131] CHIP: [TOO] TargetSoftwareVersion: 1
          [1644017080776] [33044:1032131] CHIP: [TOO] } [1644017080776]
          [33044:1032131] CHIP: [TOO] StateTransition: { [1644017080776]
          [33044:1032131] CHIP: [TOO] PreviousState: 5 [1644017080776]
          [33044:1032131] CHIP: [TOO] NewState: 1 [1644017080776]
          [33044:1032131] CHIP: [TOO] Reason: 1 [1644017080776] [33044:1032131]
          CHIP: [TOO] TargetSoftwareVersion: null [1644017080776]
          [33044:1032131] CHIP: [TOO] }"
      disabled: true

    - label:
          "DUT successfully finishes applying a software update and the new
          software image version is being executed on the DUT."
      verification:
          "chip-tool otasoftwareupdaterequestor announce-ota-provider 0xDEADBEEF
          0 0 0 0x1234567890 0 where 0x1234567890 is OTA Requestor node ID and
          0xDEADBEEF is OTA Provider node ID Subscribe to VersionApplied event
          right away after this using command chip-tool
          otasoftwareupdaterequestor subscribe-event version-applied 5 10 1 2 0
          Verify that the chip-tool receives below VersionApplied event
          notification [1645818271254] [21222:21170014] CHIP: [TOO]
          VersionApplied: { [1645818271254] [21222:21170014] CHIP: [TOO]
          SoftwareVersion: 1 [1645818271254] [21222:21170014] CHIP: [TOO]
          ProductID: 32769 [1645818271254] [21222:21170014] CHIP: [TOO] }"
      disabled: true

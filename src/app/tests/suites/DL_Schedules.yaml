# Copyright (c) 2021 Project CHIP Authors
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

name: Door Lock Cluster Schedules tests

config:
    cluster: "Door Lock"
    endpoint: 1

tests:
    - label: "Wait for the commissioned device to be retrieved"
      cluster: "DelayCommands"
      command: "WaitForCommissionee"

    - label: "Create new PIN credential and schedule user"
      command: "SetCredential"
      arguments:
          values:
              - name: "operationType"
                value: 0
              - name: "credential"
                value: { CredentialType: 1, CredentialIndex: 1 }
              - name: "credentialData"
                value: "123456"
              - name: "userIndex"
                value: null
              - name: "userStatus"
                value: null
              - name: "userType"
                value: null
      response:
          values:
              - name: "status"
                value: 0x00
              - name: "userIndex"
                value: 1
              - name: "nextCredentialIndex"
                value: 2

    - label: "Get number of supported users"
      command: "readAttribute"
      attribute: "NumberOfTotalUsersSupported"
      response:
          saveAs: NumberOfTotalUsersSupported
          value: 10

    - label:
          "Get Max number of Week Day schedules for user and verify default
          value"
      command: "readAttribute"
      attribute: "NumberOfWeekDaySchedulesSupportedPerUser"
      response:
          saveAs: NumberOfWeekDaySchedulesSupportedPerUser
          value: 10

    - label: "Create Week Day schedule with 0 index"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 0
              - name: "userIndex"
                value: 1
              - name: "daysMask"
                value: 0x01
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00
      response:
          error: INVALID_FIELD

    - label: "Create Week Day schedule with out-of-bounds index"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value:
                    static_cast<uint8_t>(NumberOfWeekDaySchedulesSupportedPerUser
                    + 1)
              - name: "userIndex"
                value: 1
              - name: "daysMask"
                value: 0x01
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00
      response:
          error: INVALID_FIELD

    - label: "Create Week Day schedule with 0 user index"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 0
              - name: "daysMask"
                value: 0x01
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00
      response:
          error: INVALID_FIELD

    - label: "Create Week Day schedule with out-of-bounds user index"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: static_cast<uint8_t>(NumberOfTotalUsersSupported + 1)
              - name: "daysMask"
                value: 0x01
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00
      response:
          error: INVALID_FIELD

    - label: "Create Week Day schedule for non-existing user"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 2
              - name: "daysMask"
                value: 0x01
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00
      response:
          error: NOT_FOUND

    - label: "Create Week Day schedule with 0 days mask"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "daysMask"
                value: 0
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00
      response:
          error: INVALID_FIELD

    - label: "Create Week Day schedule for Sunday and Monday"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "daysMask"
                value: 0x3 # (Sunday and Monday)
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00
      response:
          error: INVALID_FIELD

    - label: "Create Week Day schedule for Sunday Wednesday and Saturday"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "daysMask"
                value: 0x49 # (Sunday, Wednesday and Saturday)
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00
      response:
          error: INVALID_FIELD

    - label: "Create Week Day schedule with invalid start hour"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "daysMask"
                value: 1
              - name: "startHour"
                value: 24
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00
      response:
          error: INVALID_FIELD

    - label: "Create Week Day schedule with invalid start minute"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "daysMask"
                value: 1
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 60
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00
      response:
          error: INVALID_FIELD

    - label: "Create Week Day schedule with invalid end hour"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "daysMask"
                value: 1
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 24
              - name: "endMinute"
                value: 00
      response:
          error: INVALID_FIELD

    - label: "Create Week Day schedule with invalid end minute"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "daysMask"
                value: 1
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 60
      response:
          error: INVALID_FIELD

    - label: "Create Week Day schedule with start hour later that end hour"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "daysMask"
                value: 1
              - name: "startHour"
                value: 19
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00
      response:
          error: INVALID_FIELD

    - label:
          "Create Week Day schedule with start minute later that end minute when
          hours are equal"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "daysMask"
                value: 1
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 50
              - name: "endHour"
                value: 15
              - name: "endMinute"
                value: 49
      response:
          error: INVALID_FIELD

    - label: "Make sure that previous operations did not create a schedule"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
      response:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "status"
                value: 0x8B

    - label: "Get Week Day schedule with 0 index"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 0
              - name: "userIndex"
                value: 1
      response:
          values:
              - name: "weekDayIndex"
                value: 0
              - name: "userIndex"
                value: 1
              - name: "status"
                value: 0x85

    - label: "Get Week Day schedule with out-of-bounds index"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value:
                    static_cast<uint8_t>(NumberOfWeekDaySchedulesSupportedPerUser
                    + 1)
              - name: "userIndex"
                value: 1
      response:
          values:
              - name: "weekDayIndex"
                value:
                    static_cast<uint8_t>(NumberOfWeekDaySchedulesSupportedPerUser
                    + 1)
              - name: "userIndex"
                value: 1
              - name: "status"
                value: 0x85

    - label: "Get Week Day schedule with 0 user index"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 0
      response:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 0
              - name: "status"
                value: 0x85

    - label: "Get Week Day schedule with out-of-bounds user index"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: static_cast<uint8_t>(NumberOfTotalUsersSupported + 1)
      response:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: static_cast<uint8_t>(NumberOfTotalUsersSupported + 1)
              - name: "status"
                value: 0x85

    - label: "Get Week Day schedule with non-existing user index"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 2
      response:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 2
              - name: "status"
                value: 0x8B

    - label: "Create Week Day schedule with valid parameters"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "daysMask"
                value: 0x01
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00

    - label: "Verify created schedule"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
      response:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "status"
                value: 0x0
              - name: "daysMask"
                value: 0x01
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00

    - label: "Clear Week Day schedule with 0 index"
      command: "ClearWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 0
              - name: "userIndex"
                value: 1
      response:
          error: INVALID_FIELD

    - label: "Make sure that schedule was not deleted"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
      response:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "status"
                value: 0x0
              - name: "daysMask"
                value: 0x01
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00

    - label: "Clear Week Day schedule with out-of-bounds index"
      command: "ClearWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value:
                    static_cast<uint8_t>(NumberOfWeekDaySchedulesSupportedPerUser
                    + 1)
              - name: "userIndex"
                value: 1
      response:
          error: INVALID_FIELD

    - label: "Make sure that schedule was not deleted"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
      response:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "status"
                value: 0x0
              - name: "daysMask"
                value: 0x01
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00

    - label: "Clear Week Day schedule with 0 user index"
      command: "ClearWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 0
      response:
          error: INVALID_FIELD

    - label: "Make sure that schedule was not deleted"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
      response:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "status"
                value: 0x0
              - name: "daysMask"
                value: 0x01
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00

    - label: "Clear Week Day schedule with out-of-bounds user index"
      command: "ClearWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: static_cast<uint8_t>(NumberOfTotalUsersSupported + 1)
      response:
          error: INVALID_FIELD

    - label: "Make sure that schedule was not deleted"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
      response:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "status"
                value: 0x0
              - name: "daysMask"
                value: 0x01
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00

    - label: "Clear Week Day schedule with non-existing user"
      command: "ClearWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 2
      response:
          error: NOT_FOUND

    - label: "Make sure that schedule was not deleted"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
      response:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "status"
                value: 0x0
              - name: "daysMask"
                value: 0x01
              - name: "startHour"
                value: 15
              - name: "startMinute"
                value: 16
              - name: "endHour"
                value: 18
              - name: "endMinute"
                value: 00

    - label: "Create another Week Day schedule with valid parameters"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 2
              - name: "userIndex"
                value: 1
              - name: "daysMask"
                value: 0x02
              - name: "startHour"
                value: 0
              - name: "startMinute"
                value: 0
              - name: "endHour"
                value: 23
              - name: "endMinute"
                value: 59

    - label: "Verify created schedule"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 2
              - name: "userIndex"
                value: 1
      response:
          values:
              - name: "weekDayIndex"
                value: 2
              - name: "userIndex"
                value: 1
              - name: "status"
                value: 0x0
              - name: "daysMask"
                value: 0x02
              - name: "startHour"
                value: 0
              - name: "startMinute"
                value: 0
              - name: "endHour"
                value: 23
              - name: "endMinute"
                value: 59

    - label: "Clear a single schedule for the first user"
      command: "ClearWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1

    - label: "Verify cleared schedule"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
      response:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "status"
                value: 0x8B

    - label: "Clear all remaining schedules for the first user"
      command: "ClearWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 0xFE
              - name: "userIndex"
                value: 1

    - label: "Verify cleared schedule"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 2
              - name: "userIndex"
                value: 1
      response:
          values:
              - name: "weekDayIndex"
                value: 2
              - name: "userIndex"
                value: 1
              - name: "status"
                value: 0x8B

    - label:
          "Create new user without credential so we can add more schedules to it"
      command: "SetUser"
      arguments:
          values:
              - name: "operationType"
                value: 0
              - name: "userIndex"
                value: 2
              - name: "userName"
                value: null
              - name: "userUniqueId"
                value: null
              - name: "userStatus"
                value: null
              - name: "userType"
                value: null
              - name: "credentialRule"
                value: null

    - label: "Create Week Day schedule with valid parameters for first user"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "daysMask"
                value: 0x01
              - name: "startHour"
                value: 0
              - name: "startMinute"
                value: 0
              - name: "endHour"
                value: 23
              - name: "endMinute"
                value: 59

    - label: "Verify created week day schedule for first user"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
      response:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "status"
                value: 0x0
              - name: "daysMask"
                value: 0x01
              - name: "startHour"
                value: 0
              - name: "startMinute"
                value: 0
              - name: "endHour"
                value: 23
              - name: "endMinute"
                value: 59

    - label: "Create Week Day schedule with valid parameters for second user"
      command: "SetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 4
              - name: "userIndex"
                value: 2
              - name: "daysMask"
                value: 0x40
              - name: "startHour"
                value: 23
              - name: "startMinute"
                value: 0
              - name: "endHour"
                value: 23
              - name: "endMinute"
                value: 59

    - label: "Verify created week day schedule for first user"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 4
              - name: "userIndex"
                value: 2
      response:
          values:
              - name: "weekDayIndex"
                value: 4
              - name: "userIndex"
                value: 2
              - name: "status"
                value: 0x0
              - name: "daysMask"
                value: 0x40
              - name: "startHour"
                value: 23
              - name: "startMinute"
                value: 0
              - name: "endHour"
                value: 23
              - name: "endMinute"
                value: 59

    - label: "Cleanup"
      command: "ClearUser"
      arguments:
          values:
              - name: "userIndex"
                value: 0xFFFE

    - label: "Make sure clearing first user also cleared credentials"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
      response:
          values:
              - name: "weekDayIndex"
                value: 1
              - name: "userIndex"
                value: 1
              - name: "status"
                value: 0x8B

    - label: "Make sure clearing second user also cleared credentials"
      command: "GetWeekDaySchedule"
      arguments:
          values:
              - name: "weekDayIndex"
                value: 4
              - name: "userIndex"
                value: 2
      response:
          values:
              - name: "weekDayIndex"
                value: 4
              - name: "userIndex"
                value: 2
              - name: "status"
                value: 0x8B

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Push AV Ref Server</title>
    <script>
        const tableFormat = (headers, gen) => {

            let content = '<table><thead><tr>'

            for (const header of headers) {
                content += `<th>${header}</th>`
            } 

            content += '</tr></thead><tbody>'

            for (const iter of gen()) {
                content += "<tr>"
                for (const item of iter) {
                    content += `<td>${item}</td>`
                }
                content += "</tr>"
            }

            content += "</tbody></table>"
            
            return content
        }

        document.addEventListener('DOMContentLoaded', () => {
            const streamsTag = document.getElementById("streams")
            const certsServerTag = document.getElementById("certs-server")
            const certsDeviceTag = document.getElementById("certs-device")

            fetch('/stream')
                .then((r) => r.json())
                .then((streams) => {
                    console.log('streams', streams)

                    let content = `
                    <table>
                        <tr>
                            <th>Stream ID</th>
                            <th>File</th>
                        </tr>
                    `

                    for (const {id, files} of streams.streams) {
                        for (const file of files) {
                            content += `<tr><td>${id}</td><td>${file}</td></tr>`
                        }
                    }

                    content += "</table>"
                    
                    streamsTag.innerHTML = content
                })

            fetch('/certs')
                .then((r) => r.json())
                .then((certs) => {
                    console.log('certs', certs)

                    certsDeviceTag.innerHTML = tableFormat(['name'], function* () {
                        yield* certs.device.map((c) => [c])
                    })

                    certsServerTag.innerHTML = tableFormat(['name'], function* () {
                        yield* certs.server.map((c) => [c])
                    })
                })
        })
    </script>
  </head>
  <body>
    <h1>AV Push Server</h1>
    <h2>Streams</h2>
    <div id="streams"><!-- js generated --></div>
    <h2>Certificates</h2>
    <div>
        <h3>Server certificates</h3>
        <div id="certs-server"><!-- js generated --></div>
        <h3>Device certificates</h3>
        <div id="certs-device"><!-- js generated --></div>
    </div>
  </body>
</html>
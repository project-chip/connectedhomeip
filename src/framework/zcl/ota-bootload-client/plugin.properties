name=OTA Bootload Client
description=OTA Bootload Client
category=ZCL
quality=development

providedApis=zcl-ota-bootload-client
api.zcl-ota-bootload-client.header=ota-bootload-client.h

requiredApis=hal,stack,zcl-core,zcl-core-well-known,zcl-ota-bootload-core,zcl-ota-bootload-storage-core

ota-bootload-client.c

callbacks=callback.info

options=autoStart,blockErrorThreshold,discoverServerPeriodMinutes,queryNextImagePeriodMinutes

autoStart.name=Auto Start on Stack Up (random delay)
autoStart.description=Automatically start the OTA client on CHIP_NETWORK_UP.  This will include a random delay up to 5 minutes to prevent an issue where multiple devices in the network all query the server simultaneously after a power-outage.
autoStart.type=BOOLEAN
autoStart.default=true

blockErrorThreshold.name=Block Error Threshold
blockErrorThreshold.description=The number of failures that a node will allow before it aborts a download.
blockErrorThreshold.type=NUMBER:1,32
blockErrorThreshold.default=5

# The upperbound of this range was obtained through the CHIP_MAX_EVENT_CONTROL_DELAY_MINUTES symbol in stack/include/event.h.
discoverServerPeriodMinutes.name=Discover Server Period (Minutes)
discoverServerPeriodMinutes.description=How often a client will look for an OTA server in the network when it did not successfully discover one.
discoverServerPeriodMinutes.type=NUMBER:0,3200
discoverServerPeriodMinutes.default=10

# The upperbound of this range was obtained through the CHIP_MAX_EVENT_CONTROL_DELAY_MINUTES symbol in stack/include/event.h.
queryNextImagePeriodMinutes.name=Query Next Image Period (Minutes)
queryNextImagePeriodMinutes.description=How often a client will look for a new OTA file to download.
queryNextImagePeriodMinutes.type=NUMBER:0,3200
queryNextImagePeriodMinutes.default=60

implementedCallbacks=chipGetGlobalAddressReturn,chipZclClusterOtaBootloadClientCommandImageNotifyRequestHandler

setup(bookkeeping) {
  init=chZclOtaBootloadClientInitCallback
  networkStatus=chZclOtaBootloadClientNetworkStatusCallback
  okToLongPoll=chZclOtaBootloadClientOkToLongPoll
}

setup(eventConfiguration) {
  chZclOtaBootloadClientEventControl, chZclOtaBootloadClientEventHandler
}

setup(zclip) {
  provides: Over the Air Bootloading,client
}

setup(commandLineConfiguration) {
  ota-bootload-client update, otaBootloadClientForceUpdate
}
# Copyright (c) 2026 Project CHIP Authors
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

import("//build_overrides/build.gni")
import("//build_overrides/chip.gni")
import("${build_root}/config/compiler/compiler.gni")
import("${chip_root}/third_party/mbedtls/mbedtls3.gni")

mbedtls3_target("ot_commissioner_mbedtls") {
  mbedtls_root = "repo/third_party/mbedtls/repo"
}

config("mbedtls_config") {
  defines =
      [ "MBEDTLS_CONFIG_FILE=\"repo/third_party/mbedtls/mbedtls-config.h\"" ]
  configs = [ ":ot_commissioner_mbedtls_config" ]
  include_dirs = [ "." ]
}

config("warnings") {
  cflags = [ "-Wno-shadow" ]
}

config("public") {
  include_dirs = [ "repo/include" ]
}

static_library("ot-commissioner") {
  configs += [
    ":ot_commissioner_mbedtls_warnings",
    ":warnings",
  ]
  public = [ "repo/include/commissioner/commissioner.hpp" ]
  public_configs = [ ":public" ]
  defines = [
    "FMT_HEADER_ONLY=1",
    "OT_COMM_CONFIG_CCM_ENABLE=0",
    "OT_COMM_VERSION=\"0.2.0\"",
    "OT_COMM_CONFIG_REFERENCE_DEVICE_ENABLE=0",
  ]
  include_dirs = [
    "repo/src",
    "repo/include",
    "repo/third_party/fmtlib/repo/include",
    "repo/third_party/cn-cbor/repo/include",
    "repo/third_party/COSE-C/repo/include",
    "repo/third_party/googletest/repo/googletest/include",
    "repo/third_party/json/repo/single_include",
    "repo/third_party/mbedtls/repo/include",
    "repo/third_party/mdns/repo/include",
  ]
  sources = [
    "repo/src/common/address.cpp",
    "repo/src/common/error.cpp",
    "repo/src/common/logging.cpp",
    "repo/src/common/logging.hpp",
    "repo/src/common/time.cpp",
    "repo/src/common/time.hpp",
    "repo/src/common/utils.cpp",
    "repo/src/library/coap.cpp",
    "repo/src/library/commissioner_impl.cpp",
    "repo/src/library/commissioner_safe.cpp",
    "repo/src/library/dtls.cpp",
    "repo/src/library/joiner_session.cpp",
    "repo/src/library/mbedtls_error.cpp",
    "repo/src/library/network_data.cpp",
    "repo/src/library/openthread/bloom_filter.cpp",
    "repo/src/library/openthread/crc16.cpp",
    "repo/src/library/openthread/pbkdf2_cmac.cpp",
    "repo/src/library/openthread/random.cpp",
    "repo/src/library/openthread/sha256.cpp",
    "repo/src/library/socket.cpp",
    "repo/src/library/tlv.cpp",
    "repo/src/library/token_manager.cpp",
    "repo/src/library/udp_proxy.cpp",
  ]
  deps = [ ":ot_commissioner_mbedtls" ]
  libs = [
    "event_core",
    "event_pthreads",
  ]
}
